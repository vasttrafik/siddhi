
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Stream Processing and Complex Event Processing Engine">
      
      
        <link rel="canonical" href="https://wso2.github.io/siddhi/documentation/siddhi-4.0/">
      
      
        <meta name="author" content="WSO2">
      
      
        <link rel="shortcut icon" href="../../images/favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.6.1">
    
    
      
        <title>Siddhi Query Guide - WSO2 Siddhi</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-4d0d3f2fbf.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-f78e5cb881.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="https://wso2.github.io/siddhi/" title="WSO2 Siddhi" class="md-logo md-header-nav__button">
            <img src="../../images/siddhi-logo-w.svg" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Documentation
                </span>
              
            
            Siddhi Query Guide
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/wso2/siddhi" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      WSO2 Siddhi
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../../images/siddhi-logo-w.svg">
      </i>
    
    WSO2 Siddhi
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/wso2/siddhi" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      WSO2 Siddhi
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Welcome to WSO2 Siddhi" class="md-nav__link">
      Welcome to WSO2 Siddhi
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../features/" title="Features" class="md-nav__link">
      Features
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../siddhi-quckstart-4.0/" title="Quick Start Guide" class="md-nav__link">
      Quick Start Guide
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../user-guide/" title="User Guide" class="md-nav__link">
      User Guide
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Siddhi Query Guide
      </label>
    
    <a href="./" title="Siddhi Query Guide" class="md-nav__link md-nav__link--active">
      Siddhi Query Guide
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#streams" title="Streams" class="md-nav__link">
    Streams
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sources" title="Sources" class="md-nav__link">
    Sources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sinks" title="Sinks" class="md-nav__link">
    Sinks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query" title="Query" class="md-nav__link">
    Query
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filters" title="Filters" class="md-nav__link">
    Filters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows" title="Windows" class="md-nav__link">
    Windows
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregate-functions" title="Aggregate functions" class="md-nav__link">
    Aggregate functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregate-function-types" title="Aggregate function types" class="md-nav__link">
    Aggregate function types
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-by" title="Group By" class="md-nav__link">
    Group By
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#having" title="Having" class="md-nav__link">
    Having
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inbuilt-aggregate-functions" title="Inbuilt aggregate functions" class="md-nav__link">
    Inbuilt aggregate functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sum" title="Sum" class="md-nav__link">
    Sum
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#average" title="Average" class="md-nav__link">
    Average
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maximum" title="Maximum" class="md-nav__link">
    Maximum
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minimum" title="Minimum" class="md-nav__link">
    Minimum
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#count" title="Count" class="md-nav__link">
    Count
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#standard-deviation" title="Standard Deviation" class="md-nav__link">
    Standard Deviation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distinct-count" title="Distinct Count" class="md-nav__link">
    Distinct Count
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forever-maximum" title="Forever Maximum" class="md-nav__link">
    Forever Maximum
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forever-minimum" title="Forever Minimum" class="md-nav__link">
    Forever Minimum
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-based-aggregation" title="Time based aggregation" class="md-nav__link">
    Time based aggregation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#calculating-and-storing-time-based-aggregated-values" title="Calculating and storing time-based aggregated values" class="md-nav__link">
    Calculating and storing time-based aggregated values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-aggregate-values" title="Retrieving aggregate values" class="md-nav__link">
    Retrieving aggregate values
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inbuilt-windows" title="Inbuilt windows" class="md-nav__link">
    Inbuilt windows
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#time" title="time" class="md-nav__link">
    time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timebatch" title="timeBatch" class="md-nav__link">
    timeBatch
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#length" title="length" class="md-nav__link">
    length
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lengthbatch" title="lengthBatch" class="md-nav__link">
    lengthBatch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#externaltime" title="externalTime" class="md-nav__link">
    externalTime
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cron" title="cron" class="md-nav__link">
    cron
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firstunique" title="firstUnique" class="md-nav__link">
    firstUnique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unique" title="unique" class="md-nav__link">
    unique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sort" title="sort" class="md-nav__link">
    sort
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequent" title="frequent" class="md-nav__link">
    frequent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lossyfrequent" title="lossyFrequent" class="md-nav__link">
    lossyFrequent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#externaltimebatch" title="externalTimeBatch" class="md-nav__link">
    externalTimeBatch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timelength" title="timeLength" class="md-nav__link">
    timeLength
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uniqueexternaltimebatch" title="uniqueExternalTimeBatch" class="md-nav__link">
    uniqueExternalTimeBatch
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-event-categories" title="Output event categories" class="md-nav__link">
    Output event categories
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-rate-limiting" title="Output rate limiting" class="md-nav__link">
    Output rate limiting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#joins" title="Joins" class="md-nav__link">
    Joins
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#left-outer-join" title="Left Outer Join" class="md-nav__link">
    Left Outer Join
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#right-outer-join" title="Right Outer Join" class="md-nav__link">
    Right Outer Join
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-outer-join" title="Full Outer Join" class="md-nav__link">
    Full Outer Join
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patterns-and-sequences" title="Patterns and Sequences" class="md-nav__link">
    Patterns and Sequences
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patterns" title="Patterns" class="md-nav__link">
    Patterns
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#counting-patterns" title="Counting Patterns" class="md-nav__link">
    Counting Patterns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logical-patterns" title="Logical Patterns" class="md-nav__link">
    Logical Patterns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequences" title="Sequences" class="md-nav__link">
    Sequences
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#counting-sequences" title="Counting sequences" class="md-nav__link">
    Counting sequences
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logical-sequences" title="Logical Sequences" class="md-nav__link">
    Logical Sequences
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partitions" title="Partitions" class="md-nav__link">
    Partitions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variable-partitions" title="Variable Partitions" class="md-nav__link">
    Variable Partitions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#range-partitions" title="Range Partitions" class="md-nav__link">
    Range Partitions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-table" title="Event Table" class="md-nav__link">
    Event Table
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-an-event-table" title="Defining An Event Table" class="md-nav__link">
    Defining An Event Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-table-types" title="Event Table Types" class="md-nav__link">
    Event Table Types
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#in-memory-event-table" title="In-memory Event Table" class="md-nav__link">
    In-memory Event Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hazlecast-event-table" title="Hazlecast Event Table" class="md-nav__link">
    Hazlecast Event Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rdbms-event-table" title="RDBMS Event Table" class="md-nav__link">
    RDBMS Event Table
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#caching-events" title="Caching Events" class="md-nav__link">
    Caching Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-bloom-filters" title="Using Bloom filters" class="md-nav__link">
    Using Bloom filters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#supported-event-table-operators" title="Supported Event Table Operators" class="md-nav__link">
    Supported Event Table Operators
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert-into" title="Insert into" class="md-nav__link">
    Insert into
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete" title="Delete" class="md-nav__link">
    Delete
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" title="Update" class="md-nav__link">
    Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert-overwrite" title="Insert Overwrite" class="md-nav__link">
    Insert Overwrite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in" title="In" class="md-nav__link">
    In
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join" title="Join" class="md-nav__link">
    Join
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-window" title="Event Window" class="md-nav__link">
    Event Window
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#supported-event-window-operators" title="Supported Event Window Operators" class="md-nav__link">
    Supported Event Window Operators
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert-into_1" title="Insert Into" class="md-nav__link">
    Insert Into
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output" title="Output" class="md-nav__link">
    Output
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join_1" title="Join" class="md-nav__link">
    Join
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-trigger" title="Event Trigger" class="md-nav__link">
    Event Trigger
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#siddhi-logger" title="Siddhi Logger" class="md-nav__link">
    Siddhi Logger
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eval-script" title="Eval Script" class="md-nav__link">
    Eval Script
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      API Docs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        API Docs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M60/" title="4.0.0-M60" class="md-nav__link">
      4.0.0-M60
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M61/" title="4.0.0-M61" class="md-nav__link">
      4.0.0-M61
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M62/" title="4.0.0-M62" class="md-nav__link">
      4.0.0-M62
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M69/" title="4.0.0-M69" class="md-nav__link">
      4.0.0-M69
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M70/" title="4.0.0-M70" class="md-nav__link">
      4.0.0-M70
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M71/" title="4.0.0-M71" class="md-nav__link">
      4.0.0-M71
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M72/" title="4.0.0-M72" class="md-nav__link">
      4.0.0-M72
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M73/" title="4.0.0-M73" class="md-nav__link">
      4.0.0-M73
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M74/" title="4.0.0-M74" class="md-nav__link">
      4.0.0-M74
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M75/" title="4.0.0-M75" class="md-nav__link">
      4.0.0-M75
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M76/" title="4.0.0-M76" class="md-nav__link">
      4.0.0-M76
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M77/" title="4.0.0-M77" class="md-nav__link">
      4.0.0-M77
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M78/" title="4.0.0-M78" class="md-nav__link">
      4.0.0-M78
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M79/" title="4.0.0-M79" class="md-nav__link">
      4.0.0-M79
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M80/" title="4.0.0-M80" class="md-nav__link">
      4.0.0-M80
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M81/" title="4.0.0-M81" class="md-nav__link">
      4.0.0-M81
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#streams" title="Streams" class="md-nav__link">
    Streams
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sources" title="Sources" class="md-nav__link">
    Sources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sinks" title="Sinks" class="md-nav__link">
    Sinks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query" title="Query" class="md-nav__link">
    Query
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filters" title="Filters" class="md-nav__link">
    Filters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows" title="Windows" class="md-nav__link">
    Windows
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregate-functions" title="Aggregate functions" class="md-nav__link">
    Aggregate functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregate-function-types" title="Aggregate function types" class="md-nav__link">
    Aggregate function types
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-by" title="Group By" class="md-nav__link">
    Group By
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#having" title="Having" class="md-nav__link">
    Having
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inbuilt-aggregate-functions" title="Inbuilt aggregate functions" class="md-nav__link">
    Inbuilt aggregate functions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sum" title="Sum" class="md-nav__link">
    Sum
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#average" title="Average" class="md-nav__link">
    Average
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maximum" title="Maximum" class="md-nav__link">
    Maximum
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minimum" title="Minimum" class="md-nav__link">
    Minimum
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#count" title="Count" class="md-nav__link">
    Count
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#standard-deviation" title="Standard Deviation" class="md-nav__link">
    Standard Deviation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distinct-count" title="Distinct Count" class="md-nav__link">
    Distinct Count
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forever-maximum" title="Forever Maximum" class="md-nav__link">
    Forever Maximum
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forever-minimum" title="Forever Minimum" class="md-nav__link">
    Forever Minimum
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-based-aggregation" title="Time based aggregation" class="md-nav__link">
    Time based aggregation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#calculating-and-storing-time-based-aggregated-values" title="Calculating and storing time-based aggregated values" class="md-nav__link">
    Calculating and storing time-based aggregated values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-aggregate-values" title="Retrieving aggregate values" class="md-nav__link">
    Retrieving aggregate values
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inbuilt-windows" title="Inbuilt windows" class="md-nav__link">
    Inbuilt windows
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#time" title="time" class="md-nav__link">
    time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timebatch" title="timeBatch" class="md-nav__link">
    timeBatch
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#length" title="length" class="md-nav__link">
    length
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lengthbatch" title="lengthBatch" class="md-nav__link">
    lengthBatch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#externaltime" title="externalTime" class="md-nav__link">
    externalTime
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cron" title="cron" class="md-nav__link">
    cron
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firstunique" title="firstUnique" class="md-nav__link">
    firstUnique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unique" title="unique" class="md-nav__link">
    unique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sort" title="sort" class="md-nav__link">
    sort
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequent" title="frequent" class="md-nav__link">
    frequent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lossyfrequent" title="lossyFrequent" class="md-nav__link">
    lossyFrequent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#externaltimebatch" title="externalTimeBatch" class="md-nav__link">
    externalTimeBatch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timelength" title="timeLength" class="md-nav__link">
    timeLength
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uniqueexternaltimebatch" title="uniqueExternalTimeBatch" class="md-nav__link">
    uniqueExternalTimeBatch
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-event-categories" title="Output event categories" class="md-nav__link">
    Output event categories
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-rate-limiting" title="Output rate limiting" class="md-nav__link">
    Output rate limiting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#joins" title="Joins" class="md-nav__link">
    Joins
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#left-outer-join" title="Left Outer Join" class="md-nav__link">
    Left Outer Join
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#right-outer-join" title="Right Outer Join" class="md-nav__link">
    Right Outer Join
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#full-outer-join" title="Full Outer Join" class="md-nav__link">
    Full Outer Join
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patterns-and-sequences" title="Patterns and Sequences" class="md-nav__link">
    Patterns and Sequences
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patterns" title="Patterns" class="md-nav__link">
    Patterns
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#counting-patterns" title="Counting Patterns" class="md-nav__link">
    Counting Patterns
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logical-patterns" title="Logical Patterns" class="md-nav__link">
    Logical Patterns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequences" title="Sequences" class="md-nav__link">
    Sequences
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#counting-sequences" title="Counting sequences" class="md-nav__link">
    Counting sequences
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logical-sequences" title="Logical Sequences" class="md-nav__link">
    Logical Sequences
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partitions" title="Partitions" class="md-nav__link">
    Partitions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variable-partitions" title="Variable Partitions" class="md-nav__link">
    Variable Partitions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#range-partitions" title="Range Partitions" class="md-nav__link">
    Range Partitions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-table" title="Event Table" class="md-nav__link">
    Event Table
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-an-event-table" title="Defining An Event Table" class="md-nav__link">
    Defining An Event Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-table-types" title="Event Table Types" class="md-nav__link">
    Event Table Types
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#in-memory-event-table" title="In-memory Event Table" class="md-nav__link">
    In-memory Event Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hazlecast-event-table" title="Hazlecast Event Table" class="md-nav__link">
    Hazlecast Event Table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rdbms-event-table" title="RDBMS Event Table" class="md-nav__link">
    RDBMS Event Table
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#caching-events" title="Caching Events" class="md-nav__link">
    Caching Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-bloom-filters" title="Using Bloom filters" class="md-nav__link">
    Using Bloom filters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#supported-event-table-operators" title="Supported Event Table Operators" class="md-nav__link">
    Supported Event Table Operators
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert-into" title="Insert into" class="md-nav__link">
    Insert into
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete" title="Delete" class="md-nav__link">
    Delete
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" title="Update" class="md-nav__link">
    Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert-overwrite" title="Insert Overwrite" class="md-nav__link">
    Insert Overwrite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in" title="In" class="md-nav__link">
    In
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join" title="Join" class="md-nav__link">
    Join
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-window" title="Event Window" class="md-nav__link">
    Event Window
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#supported-event-window-operators" title="Supported Event Window Operators" class="md-nav__link">
    Supported Event Window Operators
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert-into_1" title="Insert Into" class="md-nav__link">
    Insert Into
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output" title="Output" class="md-nav__link">
    Output
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join_1" title="Join" class="md-nav__link">
    Join
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#event-trigger" title="Event Trigger" class="md-nav__link">
    Event Trigger
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#siddhi-logger" title="Siddhi Logger" class="md-nav__link">
    Siddhi Logger
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eval-script" title="Eval Script" class="md-nav__link">
    Eval Script
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="siddhi-streaming-sql-guide-40">Siddhi Streaming SQL Guide 4.0<a class="headerlink" href="#siddhi-streaming-sql-guide-40" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Siddhi Streaming SQL is designed to process event streams in streaming manner, detect complex event occurrences, 
and notify them in real-time. </p>
<p>The flowing diagram depicts how <strong>event flows</strong> within the some of the key Siddhi Streaming SQL elements.</p>
<p><img alt="Event Flow" src="../../images/event-flow.png?raw=true" title="Event Flow" /></p>
<p>Below table provides brief description of a few key elements in the Siddhi Streaming SQL Language.</p>
<table>
<thead>
<tr>
<th>Elements</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Stream</td>
<td>A logical series of events ordered in time with a uniquely identifiable name and set of defined typed attributes defining it's schema</td>
</tr>
<tr>
<td>Event</td>
<td>An event is associated with only one stream, and all events of that stream have an identical set of attributes assigned specific types (or the same schema). An event contains a timestamp and the attribute values according to the schema.</td>
</tr>
<tr>
<td>Table</td>
<td>A structured representation of stored data with defined schema, allowing stored data backed by <code>In-Memory</code>, <code>RDBMs</code>, etc to be accessed and manipulated at runtime.</td>
</tr>
<tr>
<td>Query</td>
<td>A logical construct that process events in a streaming manner by combining existing streams and/or tables, and generates events to output stream or table. A query consumes one or more input streams and zero or one table, to process events in a streaming manner, processed output events publishes them to stream or tables for further processing or notifications.</td>
</tr>
<tr>
<td>Source</td>
<td>A contracts that consumes data from external sources (such as <code>TCP</code>, <code>Kafka</code>, <code>HTTP</code>, etc), converts it's data format (such as <code>XML</code>, <code>JSON</code>, <code>binary</code>, etc) to Siddhi event, and passes that to a Stream for processing.</td>
</tr>
<tr>
<td>Sink</td>
<td>A contracts that takes events arriving at a Stream, map them to a predefined data format (such as <code>XML</code>, <code>JSON</code>, <code>binary</code>, etc), and publish them to external endpoints (such as <code>E-mail</code>, <code>TCP</code>, <code>Kafka</code>, <code>HTTP</code>, etc).</td>
</tr>
<tr>
<td>Input Handler</td>
<td>A mechanism to programmatically inject events in to Streams.</td>
</tr>
<tr>
<td>Stream/Query Callback</td>
<td>A mechanism to programmatically consumes output events at Streams and Queries.</td>
</tr>
<tr>
<td>Partition</td>
<td>A logical container that processes a queries based on a pre-defined rule of separation. Here for each partition key a separate instance of queries will be generated to achieve isolation.</td>
</tr>
<tr>
<td>Inner Stream</td>
<td>A positionable stream that connects portioned queries to preserve partition isolation.</td>
</tr>
</tbody>
</table>
<h2 id="streams">Streams<a class="headerlink" href="#streams" title="Permanent link">&para;</a></h2>
<p>Streams is a logical series of events ordered in time. It's schema is defined via the <strong>stream definition</strong>.
A stream definition contains a unique name and a set of attributes with specific types and uniquely identifiable names within the stream.
All events of a particular Stream will have the same schema (i.e. have the same attributes in the same order). </p>
<p><strong>Purpose</strong></p>
<p>By defining a schema it unifies common types of events together. This enables them to be processed at queries using their defined attributes in a streaming manner, and let sinks and sources to map events to and from various data formats.</p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax for defining a new stream.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="o">&lt;</span><span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">);</span>
</pre></div>


<p>The following parameters are configured in a stream definition.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>stream name</code></td>
<td>The name of the stream created. (as a convention <code>PascalCase</code> is used for stream name)</td>
</tr>
<tr>
<td><code>attribute name</code></td>
<td>The schema of an stream is defined by its attributes by uniquely identifiable attribute names (as a convention <code>camalCase</code> is used for attribute names)</td>
</tr>
<tr>
<td><code>attribute type</code></td>
<td>The type of each attribute defined in the schema. <br/> This can be <code>STRING</code>, <code>INT</code>, <code>LONG</code>, <code>DOUBLE</code>, <code>FLOAT</code>, <code>BOOL</code> or <code>OBJECT</code>.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span> <span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>
</pre></div>


<p>The above creates a stream named <code>TempStream</code> with the following attributes.</p>
<ul>
<li><code>deviceID</code> of type <code>long</code></li>
<li><code>roomNo</code> of type <code>int</code> </li>
<li><code>temp</code> of type <code>double</code> </li>
</ul>
<h2 id="sources">Sources<a class="headerlink" href="#sources" title="Permanent link">&para;</a></h2>
<p>Sources allow you to receive events with various data formats via multiple transports into streams for processing.</p>
<p>Source let you define a mapping to convert the incoming event from its native data format (such as <code>JSON</code>, <code>TEXT</code>, <code>XML</code>, etc) 
to Siddhi Event, when such mapping is not customised it assumes that the arriving events adhere to a predefined format.</p>
<p><strong>Purpose</strong></p>
<p>Source provides a way to Siddhi consume events from external systems and map the events to adhere to the associated stream. </p>
<p><strong>Syntax</strong></p>
<p>To configure a stream to consume events via a source, add the source configuration to a stream definition by adding the <code>@source</code> annotation and the required parameter values. 
The source syntax is as follows:</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="k">source</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;source_type&#39;</span><span class="p">,</span> <span class="k">static</span><span class="p">.</span><span class="k">option</span><span class="p">.</span><span class="n">key1</span><span class="o">=</span><span class="s1">&#39;static_option_value1&#39;</span><span class="p">,</span> <span class="k">static</span><span class="p">.</span><span class="k">option</span><span class="p">.</span><span class="n">keyN</span><span class="o">=</span><span class="s1">&#39;static_option_valueN&#39;</span><span class="p">,</span>
    <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;map_type&#39;</span><span class="p">,</span> <span class="k">static</span><span class="p">.</span><span class="n">option_key1</span><span class="o">=</span><span class="s1">&#39;static_option_value1&#39;</span><span class="p">,</span> <span class="k">static</span><span class="p">.</span><span class="k">option</span><span class="p">.</span><span class="n">keyN</span><span class="o">=</span><span class="s1">&#39;static_option_valueN&#39;</span><span class="p">,</span>
        <span class="o">@</span><span class="n">attributes</span><span class="p">(</span> <span class="n">attributeN</span><span class="o">=</span><span class="s1">&#39;attribute_mapping_N&#39;</span><span class="p">,</span> <span class="n">attribute1</span><span class="o">=</span><span class="s1">&#39;attribute_mapping_1&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">stream_name</span> <span class="p">(</span><span class="n">attribute1</span> <span class="n">Type1</span><span class="p">,</span> <span class="n">attributeN</span> <span class="n">TypeN</span><span class="p">);</span>
</pre></div>


<p><strong>Source</strong></p>
<p>The <code>type</code> parameter of <code>@source</code> defines the source type that receives events. The other parameters to be configured depends on the source selected, some of those can also be optional values. For detailed information about the parameters refer the appropriate source documentation.</p>
<p>Some of the supports source types are:</p>
<ul>
<li>TCP</li>
<li>Kafka</li>
<li>MQTT</li>
<li>RabbitMQ</li>
<li>In-Memory</li>
<li>File</li>
<li>HTTP</li>
<li>JMS</li>
<li>E-mail</li>
<li>WSO2Event</li>
</ul>
<p><strong>Source Mapper</strong></p>
<p>Each <code>@source</code> will have a mapping denoted by <code>@map</code> that converts the incoming message format to Siddhi event.</p>
<p>The <code>type</code> parameter of <code>@map</code> defines the map type that's responsible of mapping the data. The other parameters to be configured depends on the mapper selected, some of those can also be optional values. For detailed information about the parameters refer the appropriate mapper documentation.</p>
<p><strong>When <code>@map</code> is not provided <code>@map(type='passThrough')</code> will be used as default</strong>. This can be used when source consumes Siddhi events and when it does not need any mappings.</p>
<p><strong>Map Attributes</strong></p>
<p><code>@attributes</code> is an optional parameter of <code>@map</code> to define custom mapping. When <code>@attributes</code> is not provided each mapper
assumes that the incoming events will be adhere to it's own expected default data format. By defining <code>@attributes</code> you 
can configure mappers to extract data from the incoming message selectively and assign then to attributes. </p>
<p>There are two ways you can configure <code>@attributes</code>. </p>
<ol>
<li>By defining attributes as keys and mapping content as value in the following format: <br/>
<code>@attributes( attributeN='mapping_N', attribute1='mapping_1')</code> </li>
<li>By defining all attributes' mapping content in the same order as how the attributes are defined in the stream definition, such as: <br/>
<code>@attributes( 'mapping_1', 'mapping_N')</code> </li>
</ol>
<p>Some of the supports source mappings are:</p>
<ul>
<li>JSON</li>
<li>XML</li>
<li>Binary</li>
<li>Text</li>
</ul>
<p><strong>Example</strong></p>
<p>The following query receives events via the HTTP source on JSON data format, and passes them in the <code>InputStream</code> stream for processing. 
Here the HTTP source is configured to receive events on all network interfaces on port <code>8080</code> on the context <code>foo</code>, and 
its protected by basic authentication.</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="k">source</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="n">receiver</span><span class="p">.</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://0.0.0.0:8080/foo&#39;</span><span class="p">,</span> <span class="k">is</span><span class="p">.</span><span class="n">basic</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">enabled</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> 
  <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">InputStream</span> <span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">,</span> <span class="n">age</span> <span class="nb">int</span><span class="p">,</span> <span class="n">country</span> <span class="n">string</span><span class="p">);</span>
</pre></div>


<h2 id="sinks">Sinks<a class="headerlink" href="#sinks" title="Permanent link">&para;</a></h2>
<p>Sources allow you to publish events that flow through streams with various data formats and via multiple transports to external endpoints.</p>
<p>Sink let you define a mapping to convert the Siddhi event to appropriate output data format (such as <code>JSON</code>, <code>TEXT</code>, <code>XML</code>, etc), 
when such mapping is not customised it converts the events to its default data format and publishes the event.</p>
<p><strong>Purpose</strong></p>
<p>Sink provides a way to consume events generated by Siddhi by external systems in their prefixed data format. </p>
<p><strong>Syntax</strong></p>
<p>To configure a stream to publish events via a sink, add the sink configuration to a stream definition by adding the <code>@sink</code> 
annotation and the required parameter values. 
The sink syntax is as follows:</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;sink_type&#39;</span><span class="p">,</span> <span class="n">static_option_key1</span><span class="o">=</span><span class="s1">&#39;static_option_value1&#39;</span><span class="p">,</span> <span class="n">dynamic_option_key1</span><span class="o">=</span><span class="s1">&#39;{{dynamic_option_value1}}&#39;</span><span class="p">,</span>
    <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;map_type&#39;</span><span class="p">,</span> <span class="n">static_option_key1</span><span class="o">=</span><span class="s1">&#39;static_option_value1&#39;</span><span class="p">,</span> <span class="n">dynamic_option_key1</span><span class="o">=</span><span class="s1">&#39;{{dynamic_option_value1}}&#39;</span><span class="p">,</span>
        <span class="o">@</span><span class="n">payload</span><span class="p">(</span><span class="s1">&#39;payload_mapping&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">stream_name</span> <span class="p">(</span><span class="n">attribute1</span> <span class="n">Type1</span><span class="p">,</span> <span class="n">attributeN</span> <span class="n">TypeN</span><span class="p">);</span>
</pre></div>


<p>The Sink and Sink mapper properties that are categorised as <code>dynamic</code> have the ability to absorb attributes values from the Stream they are associated with. 
This can be done by incorporating the attribute names in double curly braces as <code>{{...}}</code> when configuring the property value. 
<code>'{{attribute1}}'</code>, <code>'This is {{attribute1}}'</code> and <code>{{attribute1}} &gt; {{attributeN}}</code> are some valid property values that dynamic properties can be configured with. 
 Here the attribute names in the double curly braces will be replaced with event values during execution. </p>
<p><strong>Sink</strong></p>
<p>The <code>type</code> parameter of <code>@sink</code> defines the sink type that publishes the events. The other parameters to be configured depends on the sink selected, some of those can also be optional and some can be dynamic values. For detailed information about the parameters refer the appropriate sink documentation.</p>
<p>Some of the supports sink types are:</p>
<ul>
<li>TCP</li>
<li>Kafka</li>
<li>E-mail</li>
<li>MQTT</li>
<li>RabbitMQ</li>
<li>In-Memory</li>
<li>File</li>
<li>HTTP</li>
<li>JMS</li>
<li>WSO2Event</li>
</ul>
<p><strong>Sink Mapper</strong></p>
<p>Each <code>@sink</code> will have a mapping denoted by <code>@map</code> that converts the Siddhi event to an outgoing message format.</p>
<p>The <code>type</code> parameter of <code>@map</code> defines the map type that's responsible of mapping the data. The other parameters to be configured depends on the mapper selected, some of those can also be optional or dynamic values. For detailed information about the parameters refer the appropriate mapper documentation.</p>
<p><strong>When <code>@map</code> is not provided <code>@map(type='passThrough')</code> will be used as default</strong>. This can be used when sink publishes Siddhi events and when it does not need any mappings.</p>
<p><strong>Map Payload</strong></p>
<p><code>@payload</code> is an optional parameter of <code>@map</code> to define custom mapping. When <code>@payload</code> is not provided each mapper
maps the outgoing events to it's own default data format. By defining <code>@payload</code> you 
can configure mappers to produce the output payload as of your choice using dynamic properties by selectively assigning the attributes on your preferred format. </p>
<p>There are two ways you can configure <code>@payload</code>. </p>
<ol>
<li>Some mappers such as <code>XML</code>, <code>JSON</code>, and <code>Test</code> accepts only one output payload using the following format: <br/>
<code>@payload( 'This is a test message from {{user}}.' )</code> </li>
<li>Some mappers such <code>key-value</code> accepts series of mapping values defined as: <br/>
<code>@attributes( key1='mapping_1', key2='user : {{user}}')</code> </li>
</ol>
<p>Some of the supports source mappings are:</p>
<ul>
<li>JSON</li>
<li>XML</li>
<li>Binary</li>
<li>Text</li>
<li>Key-value</li>
</ul>
<p><strong>Example</strong></p>
<p>The following query receives events via the HTTP source on JSON data format, and passes them in the <code>InputStream</code> stream for processing. 
Here the HTTP source is configured to receive events on all network interfaces on port <code>8080</code> on the context <code>foo</code>, and 
its protected by basic authentication.</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="k">source</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="n">receiver</span><span class="p">.</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://0.0.0.0:8080/foo&#39;</span><span class="p">,</span> <span class="k">is</span><span class="p">.</span><span class="n">basic</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">enabled</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> 
  <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">inputStream</span> <span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">,</span> <span class="n">age</span> <span class="nb">int</span><span class="p">,</span> <span class="n">country</span> <span class="n">string</span><span class="p">);</span>
</pre></div>


<p>The following query publishes events from <code>OutputStream</code> via the HTTP Sink. Here the events mapped as default JSON payloads are sent to <code>http://localhost:8005/endpoint</code>
 using <code>POST</code> method, <code>Accept</code> header, and basic authentication having <code>admin</code> as both the username and the password.</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="n">publisher</span><span class="p">.</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://localhost:8005/endpoint&#39;</span><span class="p">,</span> <span class="k">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;Accept-Date:20/02/2017&#39;</span><span class="p">,</span> 
  <span class="n">basic</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="n">basic</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="n">basic</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">enabled</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
  <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">OutputStream</span> <span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">,</span> <span class="n">ang</span> <span class="nb">int</span><span class="p">,</span> <span class="n">country</span> <span class="n">string</span><span class="p">);</span>
</pre></div>


<h2 id="query">Query<a class="headerlink" href="#query" title="Permanent link">&para;</a></h2>
<p>Each Siddhi query can consume one or more streams with zero or one table, process the events in streaming fashion and generate a output event to a stream or modifies a table.</p>
<p><strong>Purpose</strong></p>
<p>Query enables you to perform Complex Event Processing and Stream Processing operations by processing incoming events one by one in order. </p>
<p><strong>Syntax</strong></p>
<p>Query contain an input section and an output section. Some also contain a projection section. A simple query with all three sections is as follows.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">/</span><span class="k">table</span><span class="o">&gt;</span>
</pre></div>


<p><strong>Example</strong></p>
<p>Following simple query derives only the room temperature from the defined TempStream stream.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span> <span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="n">TempStream</span> 
<span class="k">select</span> <span class="n">roomNo</span><span class="p">,</span> <span class="n">temp</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">RoomTempStream</span><span class="p">;</span>
</pre></div>


<p><strong>Inferred Stream</strong>: Here the RoomTempStream is an inferred Stream, i.e.  RoomTempStream can be used as any other defined stream without explicitly defining its Stream Definition.  </p>
<h2 id="filters">Filters<a class="headerlink" href="#filters" title="Permanent link">&para;</a></h2>
<p>Filters are included in queries to filter information from input streams based on a specified condition.</p>
<p><strong>Purpose</strong>
A filter allows you to separate events that match a specific condition as the output, or for further processing.</p>
<p><strong>Syntax</strong></p>
<p>Filter conditions should be defined in square brackets next to the input stream name as shown below.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span><span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>


<p>The following parameters are configured in a filter definition:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>input stream name</code></td>
<td>The event stream from which events should be selected.</td>
</tr>
<tr>
<td><code>filter condition</code></td>
<td>The condition based on which the events should be filtered to be inserted into the output stream.</td>
</tr>
<tr>
<td><code>attribute name</code></td>
<td>The specific attributes of which the values should be inserted into the output stream. Multiple</td>
</tr>
<tr>
<td></td>
<td>attributes can be added as a list of comma-separated values.</td>
</tr>
<tr>
<td><code>output stream name</code></td>
<td>The event stream to which the filtered events should be inserted.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<p>The following query filters all server rooms of which the temperature is greater than 40 degrees. The filtered events
are taken from the <code>TempStream</code> input stream and inserted into the <code>HighTempStream</code> output stream.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span> <span class="p">[(</span><span class="n">roomNo</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="k">and</span> <span class="n">roomNo</span> <span class="o">&lt;</span> <span class="mi">110</span><span class="p">)</span> <span class="k">and</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">40</span> <span class="p">]</span><span class="k">select</span> <span class="n">roomNo</span><span class="p">,</span> <span class="n">temp</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">HighTempStream</span><span class="p">;</span>
</pre></div>


<h2 id="windows">Windows<a class="headerlink" href="#windows" title="Permanent link">&para;</a></h2>
<p>Windows allow you to capture a subset of events based on a specific criterion from an input event stream for calculation. Each input stream can only have maximum of one window.</p>
<p><strong>Purpose</strong></p>
<p>To create subsets of events within an event stream based on time or length. Event windows always operate as sliding windows.</p>
<p>e.g., If you define a filter condition to find the maximum value out of every 10 events, you need to define a length window of 10 events. This window operates as a sliding window where the following 3 subsets can be identified in a list of 12 events received in a sequential order.</p>
<table>
<thead>
<tr>
<th>Subset</th>
<th>Event Range</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1-10</td>
</tr>
<tr>
<td>2</td>
<td>2-11</td>
</tr>
<tr>
<td>3</td>
<td>3-12</td>
</tr>
</tbody>
</table>
<p><strong>Syntax</strong></p>
<p>The <code>#window</code> prefix should be inserted next to the relevant event stream in order to add a window.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="o">&lt;</span><span class="n">window</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">)</span><span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>


<p>The following parameters are configured in a window definition.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>input stream name</code></td>
<td>The stream to which the window is applied.</td>
</tr>
<tr>
<td><code>filter condition</code></td>
<td>The filter condition based on which events are filtered from the defined window.</td>
</tr>
<tr>
<td><code>window name</code></td>
<td><br>The name of the window. The name should include the following information:  <br>The type of the window. The supported inbuilt windows are listed in Inbuilt Windows.</br> <br>The range of the window in terms of the time duration or the number of events.</br> <br>e.g, time(10 min) defines a time window of 10 minutes.</br></td>
</tr>
<tr>
<td><code>parameter</code></td>
<td></td>
</tr>
<tr>
<td><code>attribute name</code></td>
<td>The attributes of the events selected from the window that should be inserted into the output stream. Multiple attributes can be specified as a comma-separated list.</td>
</tr>
<tr>
<td><code>output stream name</code></td>
<td></td>
</tr>
</tbody>
</table>
<p><code>For details on inbuilt windows supported for Siddhi, see Inbuilt Windows.
   For details on how to manipulate window output based on event categories, see Output Event Categories.
   For information on how to perform aggregate calculations within windows, see Aggregate Functions.</code></p>
<h3 id="aggregate-functions">Aggregate functions<a class="headerlink" href="#aggregate-functions" title="Permanent link">&para;</a></h3>
<p>Aggregate functions perform aggregate calculations within defined windows.For the complete list of inbuilt aggregate
functions supported see Inbuilt Aggregate Functions.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="n">input_stream</span><span class="o">&gt;#</span><span class="n">window</span><span class="p">.</span><span class="o">&lt;</span><span class="n">window_name</span><span class="o">&gt;</span><span class="k">select</span> <span class="o">&lt;</span><span class="n">aggregate_function</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">attribute_name</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">attribute_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute1_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute2_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="o">&lt;</span><span class="n">output_event_category</span><span class="o">&gt;</span> <span class="k">into</span> <span class="o">&lt;</span><span class="n">output_stream</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>


<p>The parameters configured are as follows:</p>
<p><strong>Example</strong>
The following query calculates the average for the temp attribute of the <code>TempStream</code> input stream within each time
window of 10 minutes. Then it emits the events to the <code>AvgTempStream</code> output stream. Each event emitted to the output
stream has the following.</p>
<ul>
<li><code>avgTemp</code> attribute with the average temperature calculated as the value.</li>
<li><code>roomNo</code> and deviceID attributes with their original values from the input stream.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="mi">10</span> <span class="k">min</span><span class="p">)</span><span class="k">select</span> <span class="k">avg</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">as</span> <span class="n">avgTemp</span><span class="p">,</span> <span class="n">roomNo</span><span class="p">,</span> <span class="n">deviceID</span>
<span class="k">insert</span> <span class="k">all</span> <span class="n">events</span> <span class="k">into</span> <span class="n">AvgTempStream</span><span class="p">;</span>
</pre></div>


<h4 id="aggregate-function-types">Aggregate function types<a class="headerlink" href="#aggregate-function-types" title="Permanent link">&para;</a></h4>
<p>The following aggregate function types are supported</p>
<h5 id="group-by">Group By<a class="headerlink" href="#group-by" title="Permanent link">&para;</a></h5>
<p><strong>Group By</strong> allows you to group the aggregate based on specified attributes.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="n">input_stream</span><span class="o">&gt;#</span><span class="n">window</span><span class="p">.</span><span class="o">&lt;</span><span class="n">window_name</span><span class="o">&gt;</span><span class="k">select</span> <span class="o">&lt;</span><span class="n">aggregate_function</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">attribute_name</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">attribute_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute1_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute2_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">group</span> <span class="k">by</span> <span class="o">&lt;</span><span class="n">attribute_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute1_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute2_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="n">output_stream</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>


<p>The parameters configured are as follows.</p>
<p><strong>Example</strong>
The following query calculates the average temperature (<code>avgTemp</code>) per room number (<code>roomNo</code>) within each sliding time
window of 10 minutes (<code>#window.time(10min)</code>) in the <code>TempStream</code> input stream, and inserts the output into the
<code>AvgTempStream</code> output stream.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="mi">10</span> <span class="k">min</span><span class="p">)</span><span class="k">select</span> <span class="k">avg</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">as</span> <span class="n">avgTemp</span><span class="p">,</span> <span class="n">roomNo</span><span class="p">,</span> <span class="n">deviceID</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">roomNo</span><span class="p">,</span> <span class="n">deviceID</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AvgTempStream</span><span class="p">;</span><span class="o">`</span>
</pre></div>


<h5 id="having">Having<a class="headerlink" href="#having" title="Permanent link">&para;</a></h5>
<p>Having allows you to filter events after aggregation and after processing at the selector.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="n">input_stream</span><span class="o">&gt;#</span><span class="n">window</span><span class="p">.</span><span class="o">&lt;</span><span class="n">window_name</span><span class="o">&gt;</span><span class="k">select</span> <span class="o">&lt;</span><span class="n">aggregate_function</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">attribute_name</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">attribute_name</span><span class="o">&gt;</span><span class="p">,</span> 
<span class="o">&lt;</span><span class="n">attribute1_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute2_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">group</span> <span class="k">by</span> <span class="o">&lt;</span><span class="n">attribute_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute1_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute2_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span><span class="o">&lt;</span>
<span class="k">having</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="n">output_stream</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>


<p>The query parameters configured are as follows.</p>
<p><strong>Example</strong></p>
<p>The following query calculates the average temperature for the last 10 minutes, and alerts if it exceeds 30 degrees.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="mi">10</span> <span class="k">min</span><span class="p">)</span><span class="k">select</span> <span class="k">avg</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">as</span> <span class="n">avgTemp</span><span class="p">,</span> <span class="n">roomNo</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">roomNo</span>
<span class="k">having</span> <span class="n">avgTemp</span> <span class="o">&gt;</span> <span class="mi">30</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AlertStream</span><span class="p">;</span>
</pre></div>


<h5 id="inbuilt-aggregate-functions">Inbuilt aggregate functions<a class="headerlink" href="#inbuilt-aggregate-functions" title="Permanent link">&para;</a></h5>
<p>Aggregate functions are used to perform operations such as sum on aggregated set of events through a window. Usage of 
an aggregate function is as follows.</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;query1&#39;</span><span class="p">)</span>
<span class="k">from</span> <span class="n">cseEventStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">timeBatch</span><span class="p">(</span><span class="mi">1</span> <span class="n">sec</span><span class="p">)</span>
<span class="k">select</span> <span class="n">symbol</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">as</span> <span class="n">price</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">resultStream</span><span class="p">;</span>
</pre></div>


<h6 id="sum">Sum<a class="headerlink" href="#sum" title="Permanent link">&para;</a></h6>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Syntax</strong></td>
<td><code>&lt;long|double&gt; sum(&lt;int|long|double|float&gt; arg)</code></td>
</tr>
<tr>
<td><strong>Extension Type</strong></td>
<td>Aggregate Function</td>
</tr>
<tr>
<td><strong>Description</strong></td>
<td>Calculates the sum for all the events.</td>
</tr>
<tr>
<td><strong>Parameter</strong></td>
<td>The value that needs to be summed.</td>
</tr>
<tr>
<td><strong>Return Type</strong></td>
<td>Returns long if the input parameter type is <code>int</code> or <code>long</code>, and returns double if the input parameter type is <code>float</code> or <code>double</code>.</td>
</tr>
<tr>
<td><strong>Examples</strong></td>
<td><br><code>sum(20)</code> returns the sum of 20s as a long value for each event arrival and expiry.</br> <code>sum(temp)</code> returns the sum of all temp attributes based on each event arrival and expiry.</td>
</tr>
</tbody>
</table>
<h6 id="average">Average<a class="headerlink" href="#average" title="Permanent link">&para;</a></h6>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Syntax</strong></td>
<td><code>&lt;double&gt; avg(&lt;int|long|double|float&gt; arg)</code></td>
</tr>
<tr>
<td><strong>Extension Type</strong></td>
<td>Aggregate Function</td>
</tr>
<tr>
<td><strong>Description</strong></td>
<td>Calculates the average for all the events.</td>
</tr>
<tr>
<td><strong>Parameter</strong></td>
<td><code>arg</code> : The value that need to be averaged.</td>
</tr>
<tr>
<td><strong>Return Type</strong></td>
<td>Returns the calculated average value as a double.</td>
</tr>
<tr>
<td><strong>Example</strong></td>
<td><code>avg(temp)</code> returns the average temp value for all the events based on their arrival and expiry.</td>
</tr>
</tbody>
</table>
<h6 id="maximum">Maximum<a class="headerlink" href="#maximum" title="Permanent link">&para;</a></h6>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Syntax</strong></td>
<td><code>&lt;int|long|double|float&gt; min(&lt;int|long|double|float&gt; arg)</code></td>
</tr>
<tr>
<td><strong>Extension Type</strong></td>
<td>Aggregate Function</td>
</tr>
<tr>
<td><strong>Description</strong></td>
<td>Returns the minimum value for all the events.</td>
</tr>
<tr>
<td><strong>Parameter</strong>}</td>
<td><strong><code>arg</code></strong>: The value that needs to be compared to find the minimum value.</td>
</tr>
<tr>
<td><strong>Return Type</strong></td>
<td>Returns the minimum value in the same type as the input.</td>
</tr>
<tr>
<td><strong>Example</strong></td>
<td><code>min(temp)</code> returns the minimum temp value recorded for all the events based on their arrival and expiry.</td>
</tr>
</tbody>
</table>
<h6 id="minimum">Minimum<a class="headerlink" href="#minimum" title="Permanent link">&para;</a></h6>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Syntax</strong></td>
<td><code>&lt;int|long|double|float&gt; min(&lt;int|long|double|float&gt; arg)</code></td>
</tr>
<tr>
<td><strong>Extension Type</strong></td>
<td>Aggregate Function</td>
</tr>
<tr>
<td><strong>Description</strong></td>
<td>Returns the minimum value for all the events.</td>
</tr>
<tr>
<td><strong>Parameter</strong></td>
<td><code>arg</code>: The value that needs to be compared to find the minimum value.</td>
</tr>
<tr>
<td><strong>Return Type</strong></td>
<td>Returns the minimum value in the same type as the input.</td>
</tr>
<tr>
<td><strong>Example</strong></td>
<td><code>min(temp)</code> returns the minimum temp value recorded for all the events based on their arrival and expiry.</td>
</tr>
</tbody>
</table>
<h6 id="count">Count<a class="headerlink" href="#count" title="Permanent link">&para;</a></h6>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;long&gt; count()</code></td>
</tr>
<tr>
<td><strong><em>Extension Type</em></strong></td>
<td>Aggregate Function</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>Returns the count of all the events.</td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns the event count as a long.</td>
</tr>
<tr>
<td><strong><em>Example</em></strong></td>
<td><code>count()</code> returns the count of all the events.</td>
</tr>
</tbody>
</table>
<h6 id="standard-deviation">Standard Deviation<a class="headerlink" href="#standard-deviation" title="Permanent link">&para;</a></h6>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;double&gt; stddev(&lt;int|long|double|float&gt; arg)</code></td>
</tr>
<tr>
<td><strong><em>Extension</em></strong></td>
<td>Aggregate Function</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>Returns the calculated standard deviation for all the events.</td>
</tr>
<tr>
<td><strong><em>Parameter</em></strong></td>
<td><code>arg</code>:The value that should be used to calculate the standard deviation.</td>
</tr>
</tbody>
</table>
<h6 id="distinct-count">Distinct Count<a class="headerlink" href="#distinct-count" title="Permanent link">&para;</a></h6>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;long&gt; distinctcount(&lt;int|long|double|float|string&gt; arg)</code></td>
</tr>
<tr>
<td><strong><em>Extension</em></strong></td>
<td>Aggregate Function</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>Returns the count of distinct occurrences for a given arg.</td>
</tr>
<tr>
<td><strong><em>Parameter</em></strong></td>
<td><code>arg</code>: The value that should be counted.</td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns the count of distinct occurances for a given arg.</td>
</tr>
<tr>
<td><strong><em>Example</em></strong></td>
<td><br><code>distinctcount(pageID)</code> for the following output returns <code>3</code>.</br> <br>"WEB_PAGE_1"</br><br>"WEB_PAGE_1"</br><br>"WEB_PAGE_2"</br><br>"WEB_PAGE_3"</br><br>"WEB_PAGE_1"</br><br>"WEB_PAGE_2"</br></td>
</tr>
</tbody>
</table>
<h6 id="forever-maximum">Forever Maximum<a class="headerlink" href="#forever-maximum" title="Permanent link">&para;</a></h6>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;int|long|double|float&gt; maxForever (&lt;int|long|double|float&gt; arg)</code></td>
</tr>
<tr>
<td><strong><em>Extension</em></strong></td>
<td>Aggregate Function</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>This is the attribute aggregator to store the maximum value for a given attribute throughout the lifetime of the query regardless of any windows in-front.</td>
</tr>
<tr>
<td><strong><em>Parameter</em></strong></td>
<td><code>arg</code>: The value that needs to be compared to find the maximum value.</td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns the maximum value in the same data type as the input.</td>
</tr>
<tr>
<td><strong><em>Example</em></strong></td>
<td><code>maxForever(temp)</code> returns the maximum temp value recorded for all the events throughout the lifetime of the query.</td>
</tr>
</tbody>
</table>
<h6 id="forever-minimum">Forever Minimum<a class="headerlink" href="#forever-minimum" title="Permanent link">&para;</a></h6>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;int|long|double|float&gt; minForever (&lt;int|long|double|float&gt; arg)</code></td>
</tr>
<tr>
<td><strong><em>Extension</em></strong></td>
<td>Aggregate Function</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>This is the attribute aggregator to store the minimum value for a given attribute throughout the lifetime of the query regardless of any windows in-front.</td>
</tr>
<tr>
<td><strong><em>Parameter</em></strong></td>
<td><code>arg</code>: The value that needs to be compared to find the minimum value.</td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns the minimum value in the same data type as the input.</td>
</tr>
<tr>
<td><strong><em>Example</em></strong></td>
<td><code>minForever(temp)</code> returns the minimum temp value recorded for all the events throughout the lifetime of the query.</td>
</tr>
</tbody>
</table>
<h4 id="time-based-aggregation">Time based aggregation<a class="headerlink" href="#time-based-aggregation" title="Permanent link">&para;</a></h4>
<p>Time-based aggregation involves obtaining aggregate attribute values (i.e., sum, average, min, max etc.) for a specified time period.</p>
<h5 id="calculating-and-storing-time-based-aggregated-values">Calculating and storing time-based aggregated values<a class="headerlink" href="#calculating-and-storing-time-based-aggregated-values" title="Permanent link">&para;</a></h5>
<p>This section explains how to write Siddhi queries to calculate aggregate values for specific time periods as required.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">store</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="ss">&quot;&lt;DATABASE_TYPE&gt;&quot;</span><span class="p">)</span>
<span class="n">define</span> <span class="n">aggregation</span> <span class="o">&lt;</span><span class="n">aggregatorName</span><span class="o">&gt;</span>
<span class="k">from</span> <span class="o">&lt;</span><span class="n">InputStreamName</span><span class="o">&gt;</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attributeName</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">aggregate_function</span><span class="o">&gt;</span><span class="p">(</span><span class="n">attributeName</span><span class="p">)</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">attributeName</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">aggregate_function</span><span class="o">&gt;</span><span class="p">(</span><span class="n">attributeName</span><span class="p">)</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">attributeName</span><span class="o">&gt;</span> <span class="p">...</span>
    <span class="k">group</span> <span class="k">by</span> <span class="o">&lt;</span><span class="n">attributeName</span><span class="o">&gt;</span>
    <span class="k">aggregate</span> <span class="k">by</span> <span class="k">timestamp</span> <span class="k">every</span> <span class="o">&lt;</span><span class="n">time_period</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>


<p>The above syntax includes the following:
Item|Description
---------|---------
<code>@store</code>|This annotation is used to refer to the data source where the events for which aggregate values are to be calculated are stored.
<code>define aggregation</code>|This specifies a unique name for the aggregation
<code>group by</code>|The attribute by which the calculated aggregate values are grouped. Specifying an attribute to group by is optional. When an attribute is specified, the aggregate values are calculated for the required time periods per value for the specified attribute. If no attribute is specified, all the events are aggregated together.
<code>aggregate by timestamp</code>|The time period for which the aggregate values are calculated. This is an optional parameter. If the time period is determined by an external timestamp (i.e., the timestamp specified as the value for the <code>_timestamp</code> attribute in the event), specific timestamps must be specified in the query with the <code>within</code> operator using supported formats (i.e., <code>&lt;yyyy&gt;-&lt;MM&gt;-&lt;dd&gt;</code>, <code>&lt;HH&gt;:&lt;mm&gt;:&lt;ss&gt;</code>, <code>&lt;Z&gt;</code> (if time is not in GMT), and <code>&lt;yyyy&gt;-&lt;MM&gt;-&lt;dd&gt; &lt;HH&gt;:&lt;mm&gt;:&lt;ss&gt;</code> (if time is in GMT). If the time period is to be determined based on the system time, you can specify the time duration for which the aggregate values should be calculated (e.g., <code>aggregate every sec...year</code> calculates aggregate values for the last second, minute, hour, day, month and year in a sliding manner.).</p>
<p><strong>Example</strong></p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">store</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="ss">&quot;rdbms&quot;</span><span class="p">)</span>
<span class="n">define</span> <span class="n">aggregation</span> <span class="n">testAggregator</span>
<span class="k">from</span> <span class="n">tradesStream</span>
<span class="k">select</span> <span class="n">symbol</span><span class="p">,</span> <span class="k">avg</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">as</span> <span class="n">avgPrice</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">as</span> <span class="n">total</span>
    <span class="k">group</span> <span class="k">by</span> <span class="n">symbol</span>
    <span class="k">aggregate</span> <span class="k">by</span> <span class="k">timestamp</span> <span class="k">every</span> <span class="n">sec</span><span class="p">...</span><span class="k">year</span><span class="p">;</span>
</pre></div>


<p>In this query, an aggregator named <code>testAggregator</code>calculates the average price and the sum of prices of the events that arrive at the <code>tradesStream</code> stream every second. These average and total are calculated per symbol, and in each second, the average and sum relevant for the last second, minute, hour, day, month, and year are output, and stored in the RDBMS database.</p>
<h5 id="retrieving-aggregate-values">Retrieving aggregate values<a class="headerlink" href="#retrieving-aggregate-values" title="Permanent link">&para;</a></h5>
<p>This section explain how to retrieve aggregate values that are already calculated and persisted in the system.
<strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="o">`</span><span class="n">InputStreamName</span><span class="o">`</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">attributeName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ATTRIBUTE_TYPE</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attributeName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ATTRIBUTE_TYPE</span><span class="o">&gt;</span> <span class="p">...);</span>

<span class="k">from</span> <span class="n">InputStreamName</span> <span class="k">as</span> <span class="n">b</span> <span class="k">join</span> <span class="o">&lt;</span><span class="n">AGGREGATION_NAME</span><span class="o">&gt;</span> <span class="k">as</span> <span class="n">a</span>
<span class="k">on</span> <span class="n">a</span><span class="p">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="n">b</span><span class="p">.</span><span class="n">symbol</span> 
<span class="n">within</span> <span class="ss">&quot;&lt;START_TIME&gt;&quot;</span><span class="p">,</span> <span class="ss">&quot;&lt;END_TIME&gt;&quot;</span> 
<span class="n">per</span> <span class="ss">&quot;&lt;TIME_PERIOD&gt;&quot;</span> 
<span class="k">select</span> <span class="n">a</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attributeName</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attributeName</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attributeName</span><span class="o">&gt;</span> 
<span class="k">insert</span> <span class="k">into</span> <span class="n">fooBar</span><span class="p">;</span>
</pre></div>


<p>The above syntax includes the following:
Item|Description
---------|---------
<code>within "&lt;START_TIME&gt;", "&lt;END_TIME&gt;"</code>|This allows you to specify the time interval for which the aggregate values need to be retrieved by specifying the timestamps for the start time and the end time.
<code>per "&lt;TIME_PERIOD&gt;"</code>|This specifies the time period by which the aggregate values must be grouped. e.g., If you specify <code>days</code>, the retrieved aggregate vlaues are displayed for each day within the selected time interval.</p>
<p><strong>Example</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">barStream</span> <span class="p">(</span><span class="n">symbol</span> <span class="n">string</span><span class="p">,</span> <span class="n">value</span> <span class="nb">int</span><span class="p">);</span>

<span class="k">from</span> <span class="n">barStream</span> <span class="k">as</span> <span class="n">b</span> <span class="k">join</span> <span class="n">testAggregator</span> <span class="k">as</span> <span class="n">a</span>
<span class="k">on</span> <span class="n">a</span><span class="p">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="n">b</span><span class="p">.</span><span class="n">symbol</span> 
<span class="n">within</span> <span class="ss">&quot;2014-02-15 00:00:00 +05:30&quot;</span><span class="p">,</span> <span class="ss">&quot;2014-03-16 00:00:00 +05:30&quot;</span> 
<span class="n">per</span> <span class="ss">&quot;days&quot;</span> 
<span class="k">select</span> <span class="n">a</span><span class="p">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">total</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">avgPrice</span> 
<span class="k">insert</span> <span class="k">into</span> <span class="n">fooBar</span><span class="p">;</span>
</pre></div>


<p>This query performs a join to match events arriving at the <code>barStream</code> stream with the events calculated and persisted by the <code>testAggregator</code> aggregator. If the value for the <code>symbol</code> attribute of an event that arrives in an input stream is the same as that of an event persisted by the aggregator, the aggregated values already calculated for it for the time period between <code>2014-02-15 00:00:00 +05:30</code> and <code>2014-03-16 00:00:00 +05:30</code> are retrieved. The aggregate values (i.e., average and the total in this scenario) for the last day is retrieved. The output events are inserted into the <code>FooBar</code> output stream.</p>
<h4 id="inbuilt-windows">Inbuilt windows<a class="headerlink" href="#inbuilt-windows" title="Permanent link">&para;</a></h4>
<p>WSO2 Siddhi supports the following inbuilt windows.</p>
<h5 id="time">time<a class="headerlink" href="#time" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;event&gt; time(&lt;int|long|time&gt; windowTime)</code></td>
</tr>
<tr>
<td><strong><em>Extension Type</em></strong></td>
<td>Window</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>A sliding time window that holds events that arrived during the last windowTime period at a given time, and gets updated for each event arrival and expiry.</td>
</tr>
<tr>
<td><strong><em>Parameter</em></strong></td>
<td><code>windowTime</code>: The sliding time period for which the window should hold events.</td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns current and expired events.</td>
</tr>
<tr>
<td><strong><em>Examples</em></strong></td>
<td><br><code>time(20)</code> for processing events that arrived within the last 20 milliseconds.</br><br><code>time(2 min)</code> for processing events that arrived within the last 2 minutes.</br></td>
</tr>
</tbody>
</table>
<h5 id="timebatch">timeBatch<a class="headerlink" href="#timebatch" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;event&gt; timeBatch(&lt;int|long|time&gt; windowTime, &lt;int&gt; startTime )</code></td>
</tr>
<tr>
<td><strong><em>Extension</em></strong></td>
<td>Window</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>A batch (tumbling) <code>time window</code> that holds events that arrive during <code>windowTime</code> periods, and gets updated for each <code>windowTime</code>.</td>
</tr>
<tr>
<td><strong><em>Parameters</em></strong></td>
<td><br><code>windowTime</code>: The batch time period for which the window should hold events.</br> <br><code>startTime (Optional)</code>: This specifies an offset in milliseconds in order to start the window at a time different to the standard time.</br></td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns current and expired events.</td>
</tr>
<tr>
<td><strong><em>Examples</em></strong></td>
<td><br><code>timeBatch(20)</code> processes events that arrive every 20 milliseconds.<br><code>timeBatch(2 min)</code> processes events that arrive every 2 minutes.</br><br><code>timeBatch(10 min, 0)</code> processes events that arrive every 10 minutes starting from the 0th minute. e.g., If you deploy your window at 08:22 and the first event arrives at 08:26, this event occurs within the time window 08.20 - 08.30. Therefore, this event is emitted at 08.30.</br> <br><code>timeBatch(10 min, 1000*60*5)</code>processes events that arrive every 10 minutes starting from 5th minute. e.g., If you deploy your window at 08:22 and the first event arrives at 08:26, this event occurs within the time window 08.25 - 08.35. Therefore, this event is emitted at 08.35.</br></td>
</tr>
</tbody>
</table>
<h6 id="length">length<a class="headerlink" href="#length" title="Permanent link">&para;</a></h6>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;event&gt; length(&lt;int&gt; windowLength)</code></td>
</tr>
<tr>
<td><strong><em>Extension Type</em></strong></td>
<td>Window</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>A sliding length window that holds the last <code>windowLength</code> events at a given time, and gets updated for each arrival and expiry.</td>
</tr>
<tr>
<td><strong><em>Parameter</em></strong></td>
<td><code>windowLength</code>: The number of events that should be included in a sliding length window.</td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong>"</td>
<td>Returns current and expired events.</td>
</tr>
<tr>
<td><strong><em>Examples</em></strong></td>
<td><br><code>length(10)</code> for processing the last 10 events.</br><br><code>length(200)</code> for processing the last 200 events.</br></td>
</tr>
</tbody>
</table>
<h5 id="lengthbatch">lengthBatch<a class="headerlink" href="#lengthbatch" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;event&gt; lengthBatch(&lt;int&gt; windowLength)</code></td>
</tr>
<tr>
<td><strong><em>Extension Type</em></strong></td>
<td>Window</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>A batch (tumbling) length window that holds a number of events specified as the <code>windowLength</code>. The window is updated each time a batch of events that equals the number specified as the <code>windowLength</code>arrives.</td>
</tr>
<tr>
<td><strong><em>Parameter</em></strong></td>
<td><code>windowLength</code>:The number of events the window should tumble.</td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns current and expired events.</td>
</tr>
<tr>
<td><strong><em>Examples</em></strong></td>
<td><br><code>lengthBatch(10)</code> for processing 10 events as a batch.</br><code>lengthBatch(200)</code> for processing 200 events as a batch.</td>
</tr>
</tbody>
</table>
<h5 id="externaltime">externalTime<a class="headerlink" href="#externaltime" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;event&gt; externalTime(&lt;long&gt; timestamp, &lt;int|long|time&gt; windowTime)</code></td>
</tr>
<tr>
<td><strong><em>Extension Type</em></strong></td>
<td>Window</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>A sliding time window based on external time. It holds events that arrived during the last <code>windowTime</code> period from the external timestamp, and gets updated on every monotonically increasing timestamp.</td>
</tr>
<tr>
<td><strong><em>Parameter</em></strong></td>
<td><code>windowTime</code>:The sliding time period for which the window should hold events.</td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns current and expired events.</td>
</tr>
<tr>
<td><strong><em>Examples</em></strong></td>
<td><br><code>externalTime(eventTime,20)</code> for processing events arrived within the last 20 milliseconds from the <code>eventTime</code>.<br><code>externalTime(eventTimestamp, 2 min)</code> for processing events arrived within the last 2 minutes from the <code>eventTimestamp</code>.</br></td>
</tr>
</tbody>
</table>
<h5 id="cron">cron<a class="headerlink" href="#cron" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;event&gt; cron(&lt;string&gt; cronExpression)</code></td>
</tr>
<tr>
<td><strong><em>Extension Type</em></strong></td>
<td>Window</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>This window returns events processed periodically as the output in time-repeating patterns, triggered based on time passing.</td>
</tr>
<tr>
<td><strong><em>Parameter</em></strong></td>
<td><code>cronExpression</code>: cron expression that represents a time schedule.</td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns current and expired events.</td>
</tr>
<tr>
<td><strong><em>Examples</em></strong></td>
<td><code>cron('*/5 * * * * ?')</code> returns processed events as the output every 5 seconds.</td>
</tr>
</tbody>
</table>
<h5 id="firstunique">firstUnique<a class="headerlink" href="#firstunique" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;event&gt; firstUnique(&lt;string&gt; attribute)</code></td>
</tr>
<tr>
<td><strong><em>Extension</em></strong></td>
<td>Window</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>First unique window processor keeps only the first events that are unique according to the given unique attribute.</td>
</tr>
<tr>
<td><strong><em>Parameter</em></strong>:<code>attribute</code>: The attribute that should be checked for uniqueness.</td>
<td></td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns current and expired events.</td>
</tr>
<tr>
<td><strong><em>Examples</em></strong></td>
<td><code>firstUnique(ip)</code> returns the first event arriving for each unique ip.</td>
</tr>
</tbody>
</table>
<h5 id="unique">unique<a class="headerlink" href="#unique" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;event&gt;  unique (&lt;string&gt;  attribute )</code></td>
</tr>
<tr>
<td><strong><em>Extension</em></strong></td>
<td>Window</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>This window keeps only the latest events that are unique according to the given unique attribute.</td>
</tr>
<tr>
<td><strong><em>Parameter</em></strong></td>
<td><code>attribute</code>: The attribute that should be checked for uniqueness.</td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns current and expired events.</td>
</tr>
<tr>
<td><strong><em>Example</em></strong></td>
<td><code>unique(ip)</code> returns the latest event that arrives for each unique <code>ip</code>.</td>
</tr>
</tbody>
</table>
<h5 id="sort">sort<a class="headerlink" href="#sort" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><br><code>&lt;event&gt; sort(&lt;int&gt; windowLength)</code></br><br><code>&lt;event&gt; sort(&lt;int&gt; windowLength, &lt;string&gt; attribute, &lt;string&gt; order)</code></br><br><code>&lt;event&gt; sort(&lt;int&gt; windowLength, &lt;string&gt; attribute, &lt;string&gt; order, .. , &lt;string&gt; attributeN, &lt;string&gt; orderN)</code></br></td>
</tr>
<tr>
<td><strong><em>Extension</em></strong></td>
<td>Window</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>This window holds a batch of events that equal the number specified as the windowLength and sorts them in the given order.</td>
</tr>
<tr>
<td><strong><em>Parameter</em></strong></td>
<td><code>attribute</code>: The attribute that should be checked for the order.</td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns current and expired events.</td>
</tr>
<tr>
<td><strong><em>Example</em></strong></td>
<td><code>sort(5, price, 'asc')</code> keeps the events sorted by <code>price</code> in the ascending order. Therefore, at any given time, the window contains the 5 lowest prices.</td>
</tr>
</tbody>
</table>
<h5 id="frequent">frequent<a class="headerlink" href="#frequent" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><br><code>&lt;event&gt; frequent(&lt;int&gt; eventCount)</code></br><br><code>&lt;event&gt; frequent(&lt;int&gt; eventCount, &lt;string&gt; attribute, .. , &lt;string&gt; attributeN)</code></br></td>
</tr>
<tr>
<td><strong><em>Extension Type</em></strong></td>
<td>Window</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>This window returns the latest events with the most frequently occurred value for a given attribute(s). Frequency calculation for this window processor is based on Misra-Gries counting algorithm.</td>
</tr>
<tr>
<td><strong><em>Parameter</em></strong></td>
<td><code>eventCount</code>: The number of most frequent events to be emitted to the stream.</td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>The number of most frequent events to be emitted to the stream.</td>
</tr>
<tr>
<td><strong><em>Examples</em></strong></td>
<td><br><code>frequent(2)</code> returns the 2 most frequent events.</br><br><code>frequent(2, cardNo)</code> returns the 2 latest events with the most frequently appeared card numbers.</br></td>
</tr>
</tbody>
</table>
<h5 id="lossyfrequent">lossyFrequent<a class="headerlink" href="#lossyfrequent" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><br><code>&lt;event&gt; lossyFrequent(&lt;double&gt; supportThreshold, &lt;double&gt; errorBound)</code></br><br><code>&lt;event&gt; lossyFrequent(&lt;double&gt; supportThreshold, &lt;double&gt; errorBound, &lt;string&gt; attribute, .. , &lt;string&gt; attributeN)</code></br></td>
</tr>
<tr>
<td><strong><em>Extension Type</em></strong></td>
<td>Window</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>This window identifies and returns all the events of which the current frequency exceeds the value specified for the <code>supportThreshold</code> parameter.</td>
</tr>
<tr>
<td><strong><em>Parameters</em></strong></td>
<td><br><code>errorBound</code>: The error bound value.</br><br><code>attribute</code>:The attributes to group the events. If no attributes are given, the concatenation of all the attributes of the event is considered.</br></td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns current and expired events.</td>
</tr>
<tr>
<td><strong><em>Examples</em></strong></td>
<td><br><code>lossyFrequent(0.1, 0.01)</code> returns all the events of which the current frequency exceeds <code>0.1</code>, with an error bound of <code>0.01</code>.</br><br>'lossyFrequent(0.3, 0.05, cardNo)<code>returns all the events of which the</code>cardNo<code>attributes frequency exceeds</code>0.3<code>, with an error bound of</code>0.05`.</td>
</tr>
</tbody>
</table>
<h5 id="externaltimebatch">externalTimeBatch<a class="headerlink" href="#externaltimebatch" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;event&gt; externalTimeBatch(&lt;long&gt; timestamp, &lt;int|long|time&gt; windowTime, &lt;int|long|time&gt; startTime, &lt;int|long|time&gt; timeout)</code></td>
</tr>
<tr>
<td><strong><em>Extension Type</em></strong></td>
<td>Window</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>A batch (tumbling) time window based on external time, that holds events arrived during <code>windowTime</code> periods, and gets updated for every <code>windowTime</code>.</td>
</tr>
<tr>
<td><strong><em>Parameters</em></strong></td>
<td><br><code>timestamp</code>: The time that the window determines as current time and will act upon. The value of this parameter should be monotonically increasing.</br><br><code>windowTime</code>: The batch time period for which the window should hold events.</br><br><code>startTime</code> (Optional): User defined start time. This could either be a constant (of type int, long or time) or an attribute of the corresponding stream (of type long). If an attribute is provided, initial value of attribute would be considered as <code>startTime</code>. When <code>startTime</code> is not given, initial value of <code>timestamp</code> is used as the default.<br><code>timeout</code>(Optional): Time to wait for arrival of new event, before flushing and giving output for events belonging to a specific batch. If timeout is not provided, system waits till an event from next batch arrives to flush current batch.</br></td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns current and expired events.</td>
</tr>
<tr>
<td><strong><em>Examples</em></strong></td>
<td><br><code>externalTimeBatch(eventTime,20)</code> for processing events that arrive every 20 milliseconds from the <code>eventTime</code>.</br><br><code>externalTimeBatch(eventTimestamp, 2 min)</code> for processing events that arrive every 2 minutes from the <code>eventTimestamp</code>.</br><br><code>externalTimeBatch(eventTimestamp, 2 sec, 0)</code> for processing events that arrive every 2 seconds from the <code>eventTimestamp</code>. This starts on 0th millisecond of an hour.</br><br><code>externalTimeBatch(eventTimestamp, 2 sec, eventTimestamp, 100)</code> for processing events that arrive every 2 seconds from the <code>eventTimestamp</code>. This considers the <code>eventTimeStamp</code> of the first event as the start time, and waits 100 milliseconds for the arrival of a new event before flushing the current batch.</br></td>
</tr>
</tbody>
</table>
<h5 id="timelength">timeLength<a class="headerlink" href="#timelength" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;event&gt; timeLength ( &lt; int|long|time &gt;   windowTime,  &lt; int &gt;  windowLength )</code></td>
</tr>
<tr>
<td><strong><em>Extension Type</em></strong></td>
<td>Window</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>A sliding time window that, at a given time holds the last windowLength events that arrived during last windowTime period, and gets updated for every event arrival and expiry.</td>
</tr>
<tr>
<td><strong><em>Parameters</em></strong></td>
<td><br><code>windowTime</code>: The sliding time period for which the window should hold events.</br><br><code>windowLength</code>: The number of events that should be be included in a sliding length window.</br></td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns current and expired events.</td>
</tr>
<tr>
<td><strong><em>Examples</em></strong></td>
<td><br><code>timeLength(20 sec, 10)</code> for processing the last 10 events that arrived within the last 20 seconds.</br><br><code>timeLength(2 min, 5)</code> for processing the last 5 events that arrived within the last 2 minutes.</br></td>
</tr>
</tbody>
</table>
<h5 id="uniqueexternaltimebatch">uniqueExternalTimeBatch<a class="headerlink" href="#uniqueexternaltimebatch" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>Detail</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Syntax</em></strong></td>
<td><code>&lt;event&gt; uniqueExternalTimeBatch(&lt;string&gt; attribute, &lt;long&gt; timestamp, &lt;int|long|time&gt; windowTime, &lt;int|long|time&gt; startTime, &lt;int|long|time&gt; timeout, &lt;bool&gt; replaceTimestampWithBatchEndTime )</code></td>
</tr>
<tr>
<td><strong><em>Extension Type</em></strong></td>
<td>Window</td>
</tr>
<tr>
<td><strong><em>Description</em></strong></td>
<td>A batch (tumbling) time window based on external time that holds latest unique events that arrive during the <code>windowTime</code> periods, and gets updated for each <code>windowTime</code>.</td>
</tr>
<tr>
<td><strong><em>Parameters</em></strong></td>
<td><br><code>attribute</code>:The attribute that should be checked for uniqueness.</br><br><code>timestamp</code>:The time considered as the current time for the window to act upon. The value of this parameter should be monotonically increasing.</br><br><code>windowTime</code>:The batch time period for which the window should hold events.</br><code>startTime</code> (Optional): The user-defined start time. This can either be a constant (of the <code>int</code>, <code>long</code> or <code>time</code> type) or an attribute of the corresponding stream (of the long type). If an attribute is provided, the initial value of this attribute is considered as the <code>startTime</code>. When the <code>startTime</code> is not given, the initial value of the timestamp is used by default.</br><br><code>timeout</code> (Optional): The time duration to wait for the arrival of new event before flushing and giving output for events belonging to a specific batch. If the timeout is not provided, the system waits until an event from next batch arrives to flush the current batch.</br><br><code>replaceTimestampWithBatchEndTime</code> (Optional): Replaces the value for the <code>timestamp</code> parameter with the corresponding batch end time stamp.</br></td>
</tr>
<tr>
<td><strong><em>Return Type</em></strong></td>
<td>Returns current and expired events.</td>
</tr>
<tr>
<td><strong><em>Examples</em></strong></td>
<td><br><code>uniqueExternalTimeBatch(ip, eventTime, 20)</code> processes unique events based on the <code>ip</code> attribute that arrives every 20 milliseconds from the  <code>eventTime</code>.</br><br><code>uniqueExternalTimeBatch(ip, eventTimestamp, 2 min)</code> processes unique events based on the <code>ip</code> attribute that arrives every 2 minutes from the <code>eventTimestamp</code>.</br><br><code>uniqueExternalTimeBatch(ip, eventTimestamp, 2 sec, 0)</code> processes unique events based on the <code>ip</code> attribute that arrives every 2 seconds from the <code>eventTimestamp</code>. It starts on 0th millisecond of an hour.</br><br><code>uniqueExternalTimeBatch(ip, eventTimestamp, 2 sec, eventTimestamp, 100)</code> processes unique events based on the <code>ip</code> attribute that arrives every 2 seconds from the <code>eventTimestamp</code>. It considers the <code>eventTimestamp</code> of the first event as the <code>startTime</code>, and waits 100 milliseconds for the arrival of a new event before flushing current batch.</br><br><code>uniqueExternalTimeBatch(ip, eventTimestamp, 2 sec, eventTimestamp, 100, true)</code> processes unique events based on the ip attribute that arrives every 2 seconds from the <code>eventTimestamp</code>. It considers the <code>eventTimestamp</code> of the first event as <code>startTime</code>, and waits 100 milliseconds for the arrival of a new event before flushing current batch. Here, the value for <code>eventTimestamp</code> is replaced with the timestamp of the batch end.</td>
</tr>
</tbody>
</table>
<h4 id="output-event-categories">Output event categories<a class="headerlink" href="#output-event-categories" title="Permanent link">&para;</a></h4>
<p>The output of a window can be current events, expired events or both as specified. Following are the key words to be used to specify the event category that is emitted from a window.</p>
<table>
<thead>
<tr>
<th>Key Word</th>
<th>Outcome</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>current events</code></td>
<td>This emits all the events that arrive to the window. This is the default event category emitted when no particular category is specified.</td>
</tr>
<tr>
<td><code>expired events</code></td>
<td>This emits all the events that expire from the window.</td>
</tr>
<tr>
<td><code>all events</code></td>
<td>This emits att the events that arrive to the window as well as all the events that expire from the window.</td>
</tr>
</tbody>
</table>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="n">input_stream</span><span class="o">&gt;#</span><span class="n">window</span><span class="p">.</span><span class="o">&lt;</span><span class="n">window_name</span><span class="o">&gt;</span><span class="k">select</span> <span class="o">*</span>
<span class="k">insert</span> <span class="o">&lt;</span><span class="n">output_event_category</span><span class="o">&gt;</span> <span class="k">into</span> <span class="o">&lt;</span><span class="n">output_stream</span><span class="o">&gt;</span>
</pre></div>


<p><strong>Example</strong>
The following selects all the expired events of the <code>TempStream</code> input stream within a time window of 1 minute, and inserts them into the <code>DelayedTempStream</code> output stream.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="mi">1</span> <span class="k">min</span><span class="p">)</span><span class="k">select</span> <span class="o">*</span>
<span class="k">insert</span> <span class="n">expired</span> <span class="n">events</span> <span class="k">into</span> <span class="n">DelayedTempStream</span>
</pre></div>


<h2 id="output-rate-limiting">Output rate limiting<a class="headerlink" href="#output-rate-limiting" title="Permanent link">&para;</a></h2>
<p>Output rate limiting allows queries to emit events periodically based on the condition specified.</p>
<p><strong>Purpose</strong></p>
<p>This allows you to limit the output to what is required in order to avoid viewing unnecessary information.</p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax of an output rate limiting configuration.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">...</span><span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">output</span> <span class="p">(</span><span class="err">{</span><span class="o">&lt;</span><span class="k">output</span><span class="o">-</span><span class="k">type</span><span class="o">&gt;</span><span class="err">}</span> <span class="k">every</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">time</span> <span class="nb">interval</span><span class="o">&gt;|&lt;</span><span class="n">event</span> <span class="nb">interval</span><span class="o">&gt;</span> <span class="n">events</span><span class="p">)</span> <span class="o">|</span> <span class="n">snapshot</span> <span class="k">every</span> <span class="o">&lt;</span><span class="n">time</span> <span class="nb">interval</span><span class="o">&gt;</span><span class="p">)</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>


<p>The parameters configured for the output rate limiting are described in the following table.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>output-time</code></td>
<td><br>This specifies which event(s) should be emitted as the output of the query. The possible values are as follows:</br><br><em><code>first</code></em>: Only the first event processed by the query in the specified time interval/sliding window is emitted.</br><br><em><code>last</code></em>: Only the last event processed by the query in the specified time interval/sliding window is emitted.</br><br><em><code>all</code></em>: All the events processed by the query in the specified time interval/sliding window are emitted.</br></td>
</tr>
<tr>
<td><code>time interval</code></td>
<td>The time interval for the periodic event emission.</td>
</tr>
<tr>
<td><code>event interval</code></td>
<td>The number of events that defines the interval at which the emission of events take place. e.g., if the event interval is 10, the query emits a result for every 10 events.</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<ul>
<li>Emitting events based on number of events
<br>Here the events are emitted every time the specified number of events arrive You can also specify whether to to emit only the first event, last event, or all events out of the events that arrived.</br>
In this example, the last temperature per sensor is emitted for every 10 events.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStreamselect</span> <span class="n">temp</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">deviceID</span>
<span class="k">output</span> <span class="k">last</span> <span class="k">every</span> <span class="mi">10</span> <span class="n">events</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">LowRateTempStream</span><span class="p">;</span>
</pre></div>


<ul>
<li>Emitting events based on time
Here, events are emitted for every predefined time interval. You can also specify whether to to emit only the first event, last event, or all events out of the events that arrived during the specified time interval.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStreamoutput</span> <span class="k">every</span> <span class="mi">10</span> <span class="n">sec</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">LowRateTempStream</span><span class="p">;</span>
</pre></div>


<ul>
<li>Emitting a periodic snapshot of events
<br>This method works best with windows. When an input stream is connected to a window, snapshot rate limiting emits all the current events that have arrived and do not have corresponding expired events for every predefined time interval. If the input stream is not connected to a window, only the last current event for each predefined time interval is emitted.</br>
The following emits a snapshot of the events in a time window of 5 seconds every 1 second. </li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="mi">5</span> <span class="n">sec</span><span class="p">)</span><span class="k">output</span> <span class="n">snapshot</span> <span class="k">every</span> <span class="mi">1</span> <span class="n">sec</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">SnapshotTempStream</span><span class="p">;</span>
</pre></div>


<h2 id="joins">Joins<a class="headerlink" href="#joins" title="Permanent link">&para;</a></h2>
<p>Join allows two event streams to be merged based on a condition. In order to carry out a join, each stream should be connected to a window. If no window is specified, a window of zero length (<code>#window.length(0)</code>) is assigned to the input event stream by default. During the joining process each incoming event on each stream is matched against all the events in the other input event stream window based on the given condition. An output event is generated for all the matching event pairs.</p>
<p><strong>Syntax</strong>
The syntax for a join is as follows:</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="o">&lt;</span><span class="n">window</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">)</span> <span class="err">{</span><span class="n">unidirectional</span><span class="err">}</span> <span class="err">{</span><span class="k">as</span> <span class="o">&lt;</span><span class="n">reference</span><span class="o">&gt;</span><span class="err">}</span>
         <span class="k">join</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;#</span><span class="n">window</span><span class="p">.</span><span class="o">&lt;</span><span class="n">window</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span>  <span class="p">...</span> <span class="p">)</span> <span class="err">{</span><span class="n">unidirectional</span><span class="err">}</span> <span class="err">{</span><span class="k">as</span> <span class="o">&lt;</span><span class="n">reference</span><span class="o">&gt;</span><span class="err">}</span>
    <span class="k">on</span> <span class="o">&lt;</span><span class="k">join</span> <span class="n">condition</span><span class="o">&gt;</span>
    <span class="n">within</span> <span class="o">&lt;</span><span class="n">time</span> <span class="n">gap</span><span class="o">&gt;</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>


<p><strong>Example</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">RegulatorStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">isOn</span> <span class="n">bool</span><span class="p">);</span>

<span class="k">from</span> <span class="n">TempStream</span><span class="p">[</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">.</span><span class="mi">0</span><span class="p">]</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="mi">1</span> <span class="k">min</span><span class="p">)</span> <span class="k">as</span> <span class="n">T</span>
  <span class="k">join</span> <span class="n">RegulatorStream</span><span class="p">[</span><span class="n">isOn</span> <span class="o">==</span> <span class="k">false</span><span class="p">]</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="k">length</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">R</span>
  <span class="k">on</span> <span class="n">T</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">R</span><span class="p">.</span><span class="n">roomNo</span>
<span class="k">select</span> <span class="n">T</span><span class="p">.</span><span class="n">roomNo</span><span class="p">,</span> <span class="n">R</span><span class="p">.</span><span class="n">deviceID</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span> <span class="k">as</span> <span class="n">action</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">RegulatorActionStream</span><span class="p">;</span>
</pre></div>


<p>WSO2 Siddhi currently supports the following types of joins.</p>
<h3 id="left-outer-join">Left Outer Join<a class="headerlink" href="#left-outer-join" title="Permanent link">&para;</a></h3>
<p>Outer join allows two event streams to be merged based on a condition. However, it returns all the events of left stream even if there are no matching events in the right stream. Here each stream should be associated with a window. During the joining process, each incoming event of each stream is matched against all the events in the other input event stream window based on the given condition. Incoming events of the right stream are matched against all events in the left event stream window based on the given condition. An output event is generated for all the matching event pairs. An output event is generated for incoming events of the left stream even if there are no matching events in right stream.</p>
<p><strong>Example</strong>
The following query generates output events for all the events in the <code>stockStream</code> stream whether there is a match for the symbol in the <code>twitterStream</code> stream or not.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">stockStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="k">length</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> 
<span class="k">left</span> <span class="k">outer</span> <span class="k">join</span> <span class="n">twitterStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="k">length</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">on</span> <span class="n">stockStream</span><span class="p">.</span><span class="n">symbol</span><span class="o">==</span> <span class="n">twitterStream</span><span class="p">.</span><span class="n">symbol</span>
<span class="k">select</span> <span class="n">stockStream</span><span class="p">.</span><span class="n">symbol</span> <span class="k">as</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">twitterStream</span><span class="p">.</span><span class="n">tweet</span><span class="p">,</span> <span class="n">stockStream</span><span class="p">.</span><span class="n">price</span>
<span class="k">insert</span> <span class="k">all</span> <span class="n">events</span> <span class="k">into</span> <span class="n">outputStream</span> <span class="p">;</span>
</pre></div>


<h3 id="right-outer-join">Right Outer Join<a class="headerlink" href="#right-outer-join" title="Permanent link">&para;</a></h3>
<p>This is similar to left outer join. It returns all the events of the right stream even if there are no matching events in the left stream. Incoming events of the left stream are matched against all events in the right event stream window based on the given condition. An output event is generated for all the matching event pairs. An output event is generated for incoming events of the right stream even if there are no matching events in left stream.</p>
<p><strong>Example</strong>
The following generates output events for all the events in the <code>twitterStream</code> stream whether there is a match for the symbol in the <code>stockStream</code> stream or not.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">stockStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="k">length</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> 
<span class="k">right</span> <span class="k">outer</span> <span class="k">join</span> <span class="n">twitterStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="k">length</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">on</span> <span class="n">stockStream</span><span class="p">.</span><span class="n">symbol</span><span class="o">==</span> <span class="n">twitterStream</span><span class="p">.</span><span class="n">symbol</span>
<span class="k">select</span> <span class="n">stockStream</span><span class="p">.</span><span class="n">symbol</span> <span class="k">as</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">twitterStream</span><span class="p">.</span><span class="n">tweet</span><span class="p">,</span> <span class="n">stockStream</span><span class="p">.</span><span class="n">price</span>
<span class="k">insert</span> <span class="k">all</span> <span class="n">events</span> <span class="k">into</span> <span class="n">outputStream</span> <span class="p">;</span>
</pre></div>


<h3 id="full-outer-join">Full Outer Join<a class="headerlink" href="#full-outer-join" title="Permanent link">&para;</a></h3>
<h2 id="patterns-and-sequences">Patterns and Sequences<a class="headerlink" href="#patterns-and-sequences" title="Permanent link">&para;</a></h2>
<p>Patterns and sequences allow event streams to be correlated over time and detect event patterns based on the order of event arrival.</p>
<h3 id="patterns">Patterns<a class="headerlink" href="#patterns" title="Permanent link">&para;</a></h3>
<p>Pattern allows event streams to be correlated over time and detect event patterns based on the order of event arrival. With pattern there can be other events in between the events that match the pattern condition. It creates state machines to track the states of the matching process internally. Pattern can correlate events over multiple input streams or over the same input stream. Therefore, each matched input event need to be referenced so that that it can be accessed for future processing and output generation.</p>
<p><strong>Syntax</strong>
The following is the syntax for a pattern configuration:</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="err">{</span><span class="k">every</span><span class="err">}</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="err">{</span><span class="k">every</span><span class="err">}</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">...</span>        <span class="n">within</span> <span class="o">&lt;</span><span class="n">time</span> <span class="n">gap</span><span class="o">&gt;</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">event</span> <span class="n">reference</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">event</span> <span class="n">reference</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>


<p><strong>Example</strong></p>
<p>The following query sends an alert if the temperature of a room increases by 5 degrees within 10 min.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="k">every</span><span class="p">(</span> <span class="n">e1</span><span class="o">=</span><span class="n">TempStream</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">e2</span><span class="o">=</span><span class="n">TempStream</span><span class="p">[</span><span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span><span class="o">==</span><span class="n">roomNo</span> <span class="k">and</span> <span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">temp</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">temp</span> <span class="p">]</span>
    <span class="n">within</span> <span class="mi">10</span> <span class="k">min</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span><span class="p">,</span> <span class="n">e1</span><span class="p">.</span><span class="n">temp</span> <span class="k">as</span> <span class="n">initialTemp</span><span class="p">,</span> <span class="n">e2</span><span class="p">.</span><span class="n">temp</span> <span class="k">as</span> <span class="n">finalTemp</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AlertStream</span><span class="p">;</span>
</pre></div>


<p>WSO2 Siddhi supports the following types of patterns:
+ Counting patterns
+ Logical patterns</p>
<h4 id="counting-patterns">Counting Patterns<a class="headerlink" href="#counting-patterns" title="Permanent link">&para;</a></h4>
<p>Counting patterns allow multiple events that may or may not have been received in a sequential order based on the same matching condition.</p>
<p><strong>Syntax</strong></p>
<p>The number of events matched can be limited via postfixes as explained below.</p>
<table>
<thead>
<tr>
<th>Postfix</th>
<th>Description</th>
<th>Example</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>n1:n2</code></td>
<td>This matches <code>n1</code> to <code>n2</code> events.</td>
<td><code>1:4</code> matches 1 to 4 events.</td>
<td></td>
</tr>
<tr>
<td><code>&lt;n:&gt;</code></td>
<td>This matches <code>n</code> or more events.</td>
<td><code>&lt;2:&gt;</code> matches 2 or more events.</td>
<td></td>
</tr>
<tr>
<td><code>&lt;:n&gt;</code></td>
<td>This matches up to <code>n</code> events.</td>
<td><code>&lt;:5&gt;</code> matches up to 5 events.</td>
<td></td>
</tr>
<tr>
<td><code>&lt;n&gt;</code></td>
<td>This matches exactly <code>n</code> events.</td>
<td><code>&lt;5&gt;</code> matches exactly 5 events.</td>
<td></td>
</tr>
</tbody>
</table>
<p>Specific occurrences of the events that should be matched based on count limits are specified via key words and numeric values within square brackets as explained with the examples given below.</p>
<ul>
<li><code>e1[3]</code> refers to the 3rd event.</li>
<li><code>e1[last]</code> refers to the last event.</li>
<li><code>e1[last - 1]</code> refers to the event before the last event.</li>
</ul>
<p><strong>Example</strong>
The following query calculates the temperature difference between two regulator events.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">RegulatorStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tempSet</span> <span class="n">double</span><span class="p">,</span> <span class="n">isOn</span> <span class="n">bool</span><span class="p">);</span>

<span class="k">from</span> <span class="k">every</span><span class="p">(</span> <span class="n">e1</span><span class="o">=</span><span class="n">RegulatorStream</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">e2</span><span class="o">=</span><span class="n">TempStream</span><span class="p">[</span><span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span><span class="o">==</span><span class="n">roomNo</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span><span class="o">&gt;</span> <span class="o">-&gt;</span> <span class="n">e3</span><span class="o">=</span><span class="n">RegulatorStream</span><span class="p">[</span><span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span><span class="o">==</span><span class="n">roomNo</span><span class="p">]</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span><span class="p">,</span> <span class="n">e2</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">temp</span> <span class="o">-</span> <span class="n">e2</span><span class="p">[</span><span class="k">last</span><span class="p">].</span><span class="n">temp</span> <span class="k">as</span> <span class="n">tempDiff</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">TempDiffStream</span><span class="p">;</span>
</pre></div>


<h4 id="logical-patterns">Logical Patterns<a class="headerlink" href="#logical-patterns" title="Permanent link">&para;</a></h4>
<p>Logical pattern matches events that arrive in temporal order and correlates events with logical relationships.</p>
<p><strong>Syntax</strong></p>
<p>Keywords such as and and or can be used instead of -&gt; to illustrate the logical relationship.</p>
<table>
<thead>
<tr>
<th>Key Word</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>and</code></td>
<td>This allows two events received in any order to be matched.</td>
</tr>
<tr>
<td><code>or</code></td>
<td>One event from either event stream can be matched regardless of the order in which the events were received.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<p><strong>Example 1: Identifying the occurence of an expected event</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">RegulatorStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tempSet</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="k">every</span><span class="p">(</span> <span class="n">e1</span><span class="o">=</span><span class="n">RegulatorStream</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">e2</span><span class="o">=</span><span class="n">TempStream</span><span class="p">[</span><span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span><span class="o">==</span><span class="n">roomNo</span> <span class="k">and</span> <span class="n">e1</span><span class="p">.</span><span class="n">tempSet</span> <span class="o">&lt;=</span> <span class="n">temp</span> <span class="p">]</span> <span class="k">or</span> <span class="n">e3</span><span class="o">=</span><span class="n">RegulatorStream</span><span class="p">[</span><span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span><span class="o">==</span><span class="n">roomNo</span><span class="p">]</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span><span class="p">,</span> <span class="n">e2</span><span class="p">.</span><span class="n">temp</span> <span class="k">as</span> <span class="n">roomTemp</span>
<span class="k">having</span> <span class="n">e3</span> <span class="k">is</span> <span class="k">null</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AlertStream</span><span class="p">;</span>
</pre></div>


<p>This query sends an alert when the room temperature reaches the temperature set on the regulator. The pattern matching is reset every time the temperature set on the regulator changes.</p>
<h3 id="sequences">Sequences<a class="headerlink" href="#sequences" title="Permanent link">&para;</a></h3>
<p>Sequence allows event streams to be correlated over time and detect event sequences based on the order of event arrival. With sequence there cannot be other events in between the events that match the sequence condition. It creates state machines to track the states of the matching process internally. Sequence can correlate events over multiple input streams or over the same input stream. Therefore, each matched input event needs to be referenced so that it can be accessed for future processing and output generation.
<strong>Syntax</strong></p>
<p>The following is the syntax for a sequence configuration.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="err">{</span><span class="k">every</span><span class="err">}</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">],</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span><span class="err">{</span><span class="o">+|*|?</span><span class="err">}</span><span class="p">,</span> <span class="p">...</span>       <span class="n">within</span> <span class="o">&lt;</span><span class="n">time</span> <span class="n">gap</span><span class="o">&gt;</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">event</span> <span class="n">reference</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">event</span> <span class="n">reference</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>


<p><strong>Example</strong></p>
<p>The following query sends an alert if there is more than 1 degree increase in the temperature between two consecutive temperature events.</p>
<p>WSO2 Siddhi supports the following types of sequences:</p>
<ul>
<li>Counting sequences</li>
<li>Logical sequences</li>
</ul>
<h4 id="counting-sequences">Counting sequences<a class="headerlink" href="#counting-sequences" title="Permanent link">&para;</a></h4>
<p>Counting sequence allows us to match multiple consecutive events based on the same matching condition.</p>
<p><strong>Syntax</strong></p>
<p>The number of events matched can be limited via postfixes as explained below.</p>
<table>
<thead>
<tr>
<th>Postfix</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>This matches zero or more events.</td>
</tr>
<tr>
<td>+</td>
<td>This matches 1 or more events.</td>
</tr>
<tr>
<td>?</td>
<td>This matches zero events or one event.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<p>The following query identifies peak temperatures.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">RegulatorStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tempSet</span> <span class="n">double</span><span class="p">,</span> <span class="n">isOn</span> <span class="n">bool</span><span class="p">);</span>

<span class="k">from</span> <span class="k">every</span> <span class="n">e1</span><span class="o">=</span><span class="n">TempStream</span><span class="p">,</span> <span class="n">e2</span><span class="o">=</span><span class="n">TempStream</span><span class="p">[</span><span class="n">e1</span><span class="p">.</span><span class="n">temp</span> <span class="o">&lt;=</span> <span class="n">temp</span><span class="p">]</span><span class="o">+</span><span class="p">,</span> <span class="n">e3</span><span class="o">=</span><span class="n">TempStream</span><span class="p">[</span><span class="n">e2</span><span class="p">[</span><span class="k">last</span><span class="p">].</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="n">temp</span><span class="p">]</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">temp</span> <span class="k">as</span> <span class="n">initialTemp</span><span class="p">,</span> <span class="n">e2</span><span class="p">[</span><span class="k">last</span><span class="p">].</span><span class="n">temp</span> <span class="k">as</span> <span class="n">peakTemp</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">TempDiffStream</span><span class="p">;</span>
</pre></div>


<h4 id="logical-sequences">Logical Sequences<a class="headerlink" href="#logical-sequences" title="Permanent link">&para;</a></h4>
<p>Logical sequence matches events that arrive in temporal order and correlates events with logical relationships.</p>
<p><strong>Syntax</strong></p>
<p>Keywords such as and and or can be used instead of -&gt; to illustrate the logical relationship.</p>
<table>
<thead>
<tr>
<th>Keyword</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>and</code></td>
<td>This allows two events received in any order to be matched.</td>
</tr>
<tr>
<td><code>or</code></td>
<td>One event from either event stream can be matched regardless of the order in which the events were received.</td>
</tr>
<tr>
<td><code>not</code></td>
<td>When this precedes a condition in a Siddhi query, it indicates that the condition is not met.</td>
</tr>
<tr>
<td><code>for</code></td>
<td>This is used to define a time period within which an event should arrive. e.g., <code>from not TemperatureStream[temp &gt; 60] for 5 sec -&gt; e1=FireAlarmStream</code> defines a condition for an event to arrive at the <code>FireAlarmStream</code> stream within 5 seconds after an event with a value greater than 60 for temperature arrives in the <code>TemperatureStream</code> stream.</td>
</tr>
</tbody>
</table>
<p><strong>Example 1: Identifying the occurence of an event</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span><span class="n">define</span> <span class="n">stream</span> <span class="n">HumidStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">humid</span> <span class="n">double</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">RegulatorStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">isOn</span> <span class="n">bool</span><span class="p">);</span>

<span class="k">from</span> <span class="k">every</span> <span class="n">e1</span><span class="o">=</span><span class="n">RegulatorStream</span><span class="p">,</span> <span class="n">e2</span><span class="o">=</span><span class="n">TempStream</span> <span class="k">and</span> <span class="n">e3</span><span class="o">=</span><span class="n">HumidStream</span>
<span class="k">select</span> <span class="n">e2</span><span class="p">.</span><span class="n">temp</span><span class="p">,</span> <span class="n">e3</span><span class="p">.</span><span class="n">humid</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">StateNotificationStream</span><span class="p">;</span>
</pre></div>


<p>This query creates a notification when a regulator event is followed by both temperature and humidity events.</p>
<p><strong>Example 2: Identifying the non-occurence of an expected event</strong>
 ```sql
 define stream CustomerStream (customerId string, timestamp long);</p>
<p>from every not CustomerStream for 7 days
 select *
 insert into OutputStream;
 <code>``
This query receives information about existing customers of the store from the</code>CustomerStream<code>stream. It identifies customers that have not visited the store for the last seven days, and outputs that information to the</code>OutputStream<code>stream. A message is generated from the</code>OutputStream` stream with information for those customers about the discounts that are currently offered at the store.</p>
<p><strong>Example 3: Detecting the non-occurence of an expected event following another event</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">LocationStream</span> <span class="p">(</span><span class="n">username</span> <span class="n">string</span><span class="p">,</span> <span class="n">latitude</span> <span class="n">double</span><span class="p">,</span> <span class="n">longitude</span> <span class="n">double</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">SpeedStream</span> <span class="p">(</span><span class="n">username</span> <span class="n">string</span><span class="p">,</span> <span class="n">speed</span> <span class="n">double</span><span class="p">);</span>
<span class="k">from</span> <span class="k">not</span> <span class="n">LocationStream</span><span class="p">[</span><span class="n">latitude</span> <span class="o">==</span> <span class="mi">43</span><span class="p">.</span><span class="mi">0096</span> <span class="k">and</span> <span class="n">longitude</span> <span class="o">==</span> <span class="mi">81</span><span class="p">.</span><span class="mi">2737</span><span class="p">]</span> <span class="k">for</span> <span class="mi">15</span> <span class="n">minutes</span> <span class="k">and</span> <span class="n">e1</span><span class="o">=</span><span class="n">SpeedStream</span><span class="p">[</span><span class="n">speed</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">.</span><span class="mi">0</span><span class="p">]</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">username</span> <span class="k">as</span> <span class="n">username</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AlertStream</span><span class="p">;</span>
</pre></div>


<p>This query receives information about the location of taxis from the <code>LocationStream</code> stream, and information about the average speed of taxis from the <code>SpeedStream</code> stream. If a taxi (i.e., a username) with an average speed greater than 60 that has not reached location at <code>latitude == 43.0096 and longitude == 81.2737</code> in 15 minutes is identified, an event is output to the <code>AlertStream</code> in order send an alert that indicates that the taxi has taken the wrong route.</p>
<p><strong>Example 4: Detecting the non-occurence of multiple events</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">LocationStream</span> <span class="p">(</span><span class="n">username</span> <span class="n">string</span><span class="p">,</span> <span class="n">latitude</span> <span class="n">double</span><span class="p">,</span> <span class="n">longitude</span> <span class="n">double</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">StateStream</span> <span class="p">(</span><span class="n">username</span> <span class="n">string</span><span class="p">,</span> <span class="k">state</span> <span class="n">string</span><span class="p">);</span>
<span class="k">from</span> <span class="k">not</span> <span class="n">LocationStream</span><span class="p">[</span><span class="n">latitude</span> <span class="o">==</span> <span class="mi">43</span><span class="p">.</span><span class="mi">0096</span> <span class="k">and</span> <span class="n">longitude</span> <span class="o">==</span> <span class="mi">81</span><span class="p">.</span><span class="mi">2737</span><span class="p">]</span> <span class="k">for</span> <span class="mi">30</span> <span class="n">minutes</span> <span class="k">and</span> <span class="k">not</span> <span class="n">StateStream</span><span class="p">[</span><span class="k">state</span> <span class="o">==</span> <span class="err"></span><span class="n">finished</span><span class="err"></span><span class="p">]</span> <span class="k">for</span> <span class="mi">30</span> <span class="n">minutes</span>
<span class="k">select</span> <span class="err"></span><span class="n">Danger</span><span class="err"></span> <span class="k">as</span> <span class="n">message</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AlertStream</span><span class="p">;</span>
</pre></div>


<p>This query receives information about the location of taxis from the <code>LocationStream</code> stream, and information about the status of the passenger from the <code>StateStream</code> stream. If the passenger (i.e., username) does not arrive at the location at <code>latitude == 43.0096 and longitude == 81.2737</code> in 30 minutes, and at the same time, if he/she has not marked the journey as <code>finished</code>, an event is output to the <code>AlertStream</code> stream to generate an alert with <code>Danger</code> as the message.</p>
<p><strong>Example 5: Detecting the non-occurence of either of two mutually exclusive events</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">LocationStream</span> <span class="p">(</span><span class="n">username</span> <span class="n">string</span><span class="p">,</span> <span class="n">latitude</span> <span class="n">double</span><span class="p">,</span> <span class="n">longitude</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="k">not</span> <span class="n">LocationStream</span><span class="p">[</span><span class="n">latitude</span> <span class="o">==</span> <span class="mi">43</span><span class="p">.</span><span class="mi">0096</span> <span class="k">and</span> <span class="n">longitude</span> <span class="o">==</span> <span class="mi">81</span><span class="p">.</span><span class="mi">2737</span><span class="p">]</span> <span class="k">for</span> <span class="mi">15</span> <span class="n">minutes</span> <span class="k">or</span> <span class="k">not</span> <span class="n">LocationStream</span><span class="p">[</span><span class="n">latitude</span> <span class="o">==</span> <span class="mi">44</span><span class="p">.</span><span class="mi">0096</span> <span class="k">and</span> <span class="n">longitude</span> <span class="o">==</span> <span class="mi">81</span><span class="p">.</span><span class="mi">2735</span><span class="p">]</span> <span class="k">for</span> <span class="mi">15</span> <span class="n">minutes</span>
<span class="k">select</span> <span class="err"></span><span class="n">Unexpected</span> <span class="n">Delay</span><span class="err"></span> <span class="k">as</span> <span class="n">message</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AlertStream</span><span class="p">;</span>
</pre></div>


<p>This query receives information about the location of taxis from the <code>LocationStream</code> stream. If a taxi has not reached either the location at <code>latitude == 43.0096 and longitude == 81.2737</code>, or the one at <code>latitude == 44.0096 and longitude == 81.2735</code> in 15 minutes, an event is output to the <code>AlertStream</code> stream to generate an alert with <code>Unexpected Delay</code> as the message.</p>
<p><strong>Example 6: Detecting the non-occurence of one event or the occurence of another</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">LocationStream</span> <span class="p">(</span><span class="n">username</span> <span class="n">string</span><span class="p">,</span> <span class="n">latitude</span> <span class="n">double</span><span class="p">,</span> <span class="n">longitude</span> <span class="n">double</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">DangerStream</span> <span class="p">(</span><span class="n">username</span> <span class="n">string</span><span class="p">);</span>
<span class="k">from</span> <span class="k">not</span> <span class="n">LocationStream</span><span class="p">[</span><span class="n">latitude</span> <span class="o">==</span> <span class="mi">43</span><span class="p">.</span><span class="mi">0096</span> <span class="k">and</span> <span class="n">longitude</span> <span class="o">==</span> <span class="mi">81</span><span class="p">.</span><span class="mi">2737</span><span class="p">]</span> <span class="k">for</span> <span class="mi">30</span> <span class="n">minutes</span> <span class="k">or</span> <span class="n">e1</span><span class="o">=</span><span class="n">DangerStream</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">username</span> <span class="k">as</span> <span class="n">username</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AlertStream</span><span class="p">;</span>
</pre></div>


<p>This query receives information about the location of taxis from the <code>LocationStream</code> stream, and information about whether the passenger is in danger from the <code>DangerStream</code> stream. After 30 minutes, it checkes whether the passenger has reached the location at <code>latitude == 43.0096 and longitude == 81.2737</code>, or marked to indicate that he/she is in danger. If the passenger has not reached the location, or if he/she has indicated that he/she is in danger, an event is output to the <code>AlertStream</code> stream in order to generate an alert to indicate that the passenger is in danger.</p>
<p><strong>Example 7: Identifying the occurence of an unexpected event within a specified time interval</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TemperatureStream</span> <span class="p">(</span><span class="n">temp</span> <span class="nb">float</span><span class="p">,</span> <span class="k">timestamp</span> <span class="n">long</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">FireAlarmStream</span> <span class="p">(</span><span class="n">active</span> <span class="nb">boolean</span><span class="p">);</span>
<span class="k">from</span> <span class="k">not</span> <span class="n">TemperatureStream</span><span class="p">[</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">]</span> <span class="k">for</span> <span class="mi">5</span> <span class="n">sec</span> <span class="o">-&gt;</span> <span class="n">e1</span><span class="o">=</span><span class="n">FireAlarmStream</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">id</span> <span class="k">as</span> <span class="n">alarmId</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AlertStream</span><span class="p">;</span>
</pre></div>


<p>This query receives information about the temperature from the <code>TemperatureStream</code> stream, and information about the state of the fire alarm from the <code>FireAlarmStream</code> stream. If the state of the fire alarm is <code>active</code> within a period of 5 seconds during which the temperature is less than 60 degrees, an event is output to the <code>AlertStream</code> stream in order to indicate that the fire alarm generates false alerts.</p>
<p><strong>Example 8: Identifying the non-occurence of an expected event within a specified time period</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TemperatureStream</span> <span class="p">(</span><span class="n">temp</span> <span class="nb">float</span><span class="p">,</span> <span class="k">timestamp</span> <span class="n">long</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">FireAlarmStream</span> <span class="p">(</span><span class="n">active</span> <span class="nb">boolean</span><span class="p">);</span>
<span class="k">from</span> <span class="n">TemperatureStream</span><span class="p">[</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="k">not</span> <span class="n">FireAlarmStream</span><span class="p">[</span><span class="n">active</span> <span class="o">==</span> <span class="k">true</span><span class="p">]</span> <span class="k">for</span> <span class="mi">5</span> <span class="n">sec</span>
<span class="k">select</span> <span class="s1">&#39;Fire alarm not working&#39;</span> <span class="k">as</span> <span class="n">message</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AlertStream</span><span class="p">;</span>
</pre></div>


<p>This query receives information about the temperature from the <code>TemperatureStream</code> stream, and information about the state of the fire alarm from the <code>FireAlarmStream</code> stream. If an event where the state of the fire alarm is <code>active</code> does not arrive within five seconds after an event that indicates that the temperature has risen above 60 degrees, an event is output to the <code>AlertStream</code> stream with <code>Fire alarm not working</code> as the message.</p>
<p><strong>Example 9: Identifying the occurence of an even that is not preceded by another expected event</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">LocationStream</span> <span class="p">(</span><span class="n">locationId</span> <span class="n">string</span><span class="p">,</span> <span class="n">customerId</span> <span class="n">string</span><span class="p">);</span>

<span class="k">from</span> <span class="k">not</span> <span class="n">LocationStream</span><span class="p">[</span><span class="n">locationId</span> <span class="o">==</span> <span class="s1">&#39;zoneA&#39;</span><span class="p">]</span> <span class="k">and</span> <span class="n">e1</span><span class="o">=</span><span class="n">LocationStream</span><span class="p">[</span><span class="n">locationId</span> <span class="o">==</span>  <span class="s1">&#39;billingCounter&#39;</span><span class="p">]</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">customerId</span> <span class="k">as</span> <span class="n">customerId</span><span class="p">,</span> <span class="s1">&#39;Great deals are waiting for you at zone A&#39;</span> <span class="k">as</span> <span class="n">message</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">NotificationStream</span><span class="p">;</span>
</pre></div>


<p>This query receives information about the location of customers from the <code>LocationStream</code> stream. If an event indicates that a customer has reached the <code>bilingCounter</code> location, and it is not preceded by an event that indicates that the same customer has been to the <code>zoneA</code> location, an event is output to the <code>NotificationStream</code> stream in order to generate a notification with <code>Great deals are waiting for you at zone A</code> as the message.</p>
<h2 id="partitions">Partitions<a class="headerlink" href="#partitions" title="Permanent link">&para;</a></h2>
<p>Partitions allow events and queries to be divided in order to process them in parallel and in isolation. Each partition is tagged with a partition key. Only events corresponding to this key are processed for each partition. A partition can contain one or more Siddhi queries.
Siddhi supports both variable partitions and well as range partitions.</p>
<h3 id="variable-partitions">Variable Partitions<a class="headerlink" href="#variable-partitions" title="Permanent link">&para;</a></h3>
<p>A variable partition is created by defining the partition key using the categorical (string) attribute of the input event stream.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="n">partition</span> <span class="k">with</span> <span class="p">(</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="k">of</span> <span class="o">&lt;</span><span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="k">of</span> <span class="o">&lt;</span><span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">)</span><span class="k">begin</span>
    <span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span>
    <span class="p">...</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>


<p><strong>Example</strong></p>
<p>The following query calculates the maximum temperature recorded for the last 10 events emitted per sensor.</p>
<div class="codehilite"><pre><span></span><span class="n">partition</span> <span class="k">with</span> <span class="p">(</span> <span class="n">deviceID</span> <span class="k">of</span> <span class="n">TempStream</span> <span class="p">)</span><span class="k">begin</span>
    <span class="k">from</span> <span class="n">TempStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="k">length</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">select</span> <span class="n">roomNo</span><span class="p">,</span> <span class="n">deviceID</span><span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">as</span> <span class="n">maxTemp</span>
    <span class="k">insert</span> <span class="k">into</span> <span class="n">DeviceTempStream</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>


<h3 id="range-partitions">Range Partitions<a class="headerlink" href="#range-partitions" title="Permanent link">&para;</a></h3>
<p>A range partition is created by defining the partition key using the numerical attribute of the input event stream.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="n">partition</span> <span class="k">with</span> <span class="p">(</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">partition</span> <span class="k">key</span><span class="o">&gt;</span> <span class="k">or</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">partition</span> <span class="k">key</span><span class="o">&gt;</span> <span class="k">or</span> <span class="p">...</span> <span class="k">of</span> <span class="o">&lt;</span><span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">)</span><span class="k">begin</span>
    <span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span>
    <span class="p">...</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>


<p><strong>Example</strong></p>
<p>The following query calculates the average temperature for the last 10 minutes per office area.</p>
<div class="codehilite"><pre><span></span><span class="n">partition</span> <span class="k">with</span> <span class="p">(</span> <span class="n">roomNo</span><span class="o">&gt;=</span><span class="mi">1030</span> <span class="k">as</span> <span class="s1">&#39;serverRoom&#39;</span> <span class="k">or</span> <span class="n">roomNo</span><span class="o">&lt;</span><span class="mi">1030</span> <span class="k">and</span> <span class="n">roomNo</span><span class="o">&gt;=</span><span class="mi">330</span> <span class="k">as</span> <span class="s1">&#39;officeRoom&#39;</span> <span class="k">or</span> <span class="n">roomNo</span><span class="o">&lt;</span><span class="mi">330</span> <span class="k">as</span> <span class="s1">&#39;lobby&#39;</span> <span class="k">of</span> <span class="n">TempStream</span><span class="p">)</span> <span class="p">)</span><span class="k">begin</span>
    <span class="k">from</span> <span class="n">TempStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="mi">10</span> <span class="k">min</span><span class="p">)</span>
    <span class="k">select</span> <span class="n">roomNo</span><span class="p">,</span> <span class="n">deviceID</span><span class="p">,</span> <span class="k">avg</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">as</span> <span class="n">avgTemp</span>
    <span class="k">insert</span> <span class="k">into</span> <span class="n">AreaTempStream</span>
<span class="k">end</span><span class="p">;</span>
</pre></div>


<h2 id="event-table">Event Table<a class="headerlink" href="#event-table" title="Permanent link">&para;</a></h2>
<p>An event table is a stored version of an event stream or a table of events. It allows Siddhi to work with stored events. Events are stored in-memory by default, and Siddhi also provides an extension to work with data/events stored in RDBMS data stores.</p>
<h3 id="defining-an-event-table">Defining An Event Table<a class="headerlink" href="#defining-an-event-table" title="Permanent link">&para;</a></h3>
<p>An event table definition defines the table schema. The syntax for an event table definition is as follows.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">table</span> <span class="o">&lt;</span><span class="k">table</span> <span class="n">name</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">);</span>
</pre></div>


<p><strong>Example</strong></p>
<p>The following creates a table named <code>RoomTypeTable</code> with the attributes <code>roomNo</code> (an <code>INT</code> attribute) and <code>type</code> (a <code>STRING</code> attribute).</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">table</span> <span class="n">RoomTypeTable</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">);</span>
</pre></div>


<h3 id="event-table-types">Event Table Types<a class="headerlink" href="#event-table-types" title="Permanent link">&para;</a></h3>
<p>Siddhi supports the following types of event tables.</p>
<h4 id="in-memory-event-table">In-memory Event Table<a class="headerlink" href="#in-memory-event-table" title="Permanent link">&para;</a></h4>
<p>In memory event tables are created to store events for later access. Event tables can be configured with primary keys to avoid the duplication of data, and indexes for fast event access.
Primary keys are configured by including the <code>@PrimaryKey</code> annotation within the event table configuration. Each event table can have only one attribute defined as the primary key, and the value for this attribute should be unique for each entry saved in the table. This ensures that entries in the table are not duplicated
Indexes are configured by including the <code>@Index</code> annotation within the event table configuration. Each event table configuration can have only one <code>@Index</code> annotation. However, multiple attributes can be specified as index attributes via a single annotation. When the <code>@Index</code> annotation is defined, multiple entries can be stored for a given key in the table. Indexes can be configured together with primary keys. </p>
<p><strong>Examples</strong></p>
<ul>
<li>Configuring primary keys
The following query creates an event table with the <code>symbol</code> attribute defined as the primary key. Therefore, each entry in this table should have a unique value for the <code>symbol</code> attribute.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">PrimaryKey</span><span class="p">(</span><span class="s1">&#39;symbol&#39;</span><span class="p">)</span>
<span class="n">define</span> <span class="k">table</span> <span class="n">StockTable</span> <span class="p">(</span><span class="n">symbol</span> <span class="n">string</span><span class="p">,</span> <span class="n">price</span> <span class="nb">float</span><span class="p">,</span> <span class="n">volume</span> <span class="n">long</span><span class="p">);</span>
</pre></div>


<ul>
<li>Configuring indexes</li>
</ul>
<p>The following query creates an indexed event table named <code>RoomTypeTable</code> with the attributes <code>roomNo</code> (as an <code>INT</code> attribute) and <code>type</code> (as a <code>STRIN</code>G attribute). All entries in the table are to be indexed by the <code>roomNo</code> attribute.</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="k">Index</span><span class="p">(</span><span class="s1">&#39;roomNo&#39;</span><span class="p">)</span>
<span class="n">define</span> <span class="k">table</span> <span class="n">RoomTypeTable</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">);</span>
</pre></div>


<h4 id="hazlecast-event-table">Hazlecast Event Table<a class="headerlink" href="#hazlecast-event-table" title="Permanent link">&para;</a></h4>
<p>Event tables allow event data to be persisted in a distributed manner using Hazelcast in-memory data grids. This functionality is enabled using the <code>From</code> annotation. Also, the connection instructions for the Hazelcast cluster can be provided with the <code>From</code> annotation.
The following is a list of connection instructions that can be provided with the <code>From</code> annotation.</p>
<ul>
<li><code>cluster.name : Hazelcast cluster/group name [Optional]  (i.e cluster.name='cluster_a')</code></li>
<li><code>cluster.password : Hazelcast cluster/group password [Optional]  (i.e cluster.password='pass@cluster_a')</code></li>
<li><code>cluster.addresses : Hazelcast cluster addresses (ip:port) as a comma separated string [Optional, client mode only] (i.e cluster.addresses='192.168.1.1:5700,192.168.1.2:5700')</code></li>
<li><code>well.known.addresses : Hazelcast WKAs (ip) as a comma separated string [Optional, server mode only] (i.e well.known.addresses='192.168.1.1,192.168.1.2')</code></li>
<li><code>collection.name : Hazelcast collection object name [Optional, can be used to share single table between multiple EPs] (i.e collection.name='stockTable')</code></li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>Creating a table backed by a new Hazelcast instance</li>
</ul>
<p>The following query creates an event table named <code>RoomTypeTable</code> with the attributes <code>roomNo</code> (an <code>INT</code> attribute) and <code>type</code> (a <code>STRING</code> attribute), backed by a <em>new</em> Hazelcast Instance.</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="k">from</span><span class="p">(</span><span class="n">eventtable</span> <span class="o">=</span> <span class="s1">&#39;hazelcast&#39;</span><span class="p">)</span>
<span class="n">define</span> <span class="k">table</span> <span class="n">RoomTypeTable</span><span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">);</span>
</pre></div>


<ul>
<li>Creating a table backed by a new Hazelcast instance in a new Hazelcast cluster
The following query creates an event table named <code>RoomTypeTable</code> with the attributes <code>roomNo</code> (an <code>INT</code> attribute) and <code>type</code> (a <code>STRING</code> attribute), backed by a <em>new</em> Hazelcast Instance in a new Hazelcast cluster.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="k">from</span><span class="p">(</span><span class="n">eventtable</span> <span class="o">=</span> <span class="s1">&#39;hazelcast&#39;</span><span class="p">,</span> <span class="k">cluster</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;cluster_a&#39;</span><span class="p">,</span> <span class="k">cluster</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;pass@cluster_a&#39;</span><span class="p">)</span>
<span class="n">define</span> <span class="k">table</span> <span class="n">RoomTypeTable</span><span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">);</span>
</pre></div>


<ul>
<li>Creating a table backed by an existing Hazelcast instance in an existing Hazelcast cluster
The following query creates an event table named <code>RoomTypeTable</code> with the attributes <code>roomNo</code> (an <code>INT</code> attribute) and <code>type</code> (a <code>STRING</code> attribute), backed by an existing Hazelcast Instance in an existing Hazelcast Cluster.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="k">from</span><span class="p">(</span><span class="n">eventtable</span> <span class="o">=</span> <span class="s1">&#39;hazelcast&#39;</span><span class="p">,</span> <span class="k">cluster</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;cluster_a&#39;</span><span class="p">,</span> <span class="k">cluster</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;pass@cluster_a&#39;</span><span class="p">,</span> <span class="k">cluster</span><span class="p">.</span><span class="n">addresses</span><span class="o">=</span><span class="s1">&#39;192.168.1.1:5700,192.168.1.2.5700&#39;</span><span class="p">)</span>
<span class="n">define</span> <span class="k">table</span> <span class="n">RoomTypeTable</span><span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">);</span>
</pre></div>


<h4 id="rdbms-event-table">RDBMS Event Table<a class="headerlink" href="#rdbms-event-table" title="Permanent link">&para;</a></h4>
<p>An event table can be backed with an RDBMS event store using the <code>From</code> annotation. You can also provide the connection instructions to the event table with this annotation. The RDBMS table name can be different from the event table name defined in Siddhi, and Siddhi always refers to the defined event table name. However the defined event table name cannot be same as an already existing stream name because syntactically, both are considered the same in the Siddhi Query Language.</p>
<p>*The RDBMS event table has been tested with the following databases:</p>
<ul>
<li>MySQL</li>
<li>H2</li>
<li>Oracle*</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>Creating an event table backed by an RDBMS table</li>
</ul>
<p>The following query creates an event table named <code>RoomTypeTable</code> with the attributes <code>roomNo</code> (an <code>INT</code> attribute) and <code>type</code> (a <code>STRING</code> attribute), backed by an RDBMS table named <code>RoomTable</code> from the data source named <code>AnalyticsDataSource</code>.</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="k">From</span><span class="p">(</span><span class="n">eventtable</span><span class="o">=</span><span class="s1">&#39;rdbms&#39;</span><span class="p">,</span> <span class="n">datasource</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;AnalyticsDataSource&#39;</span><span class="p">,</span> <span class="k">table</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;RoomTable&#39;</span><span class="p">)</span>
<span class="n">define</span> <span class="k">table</span> <span class="n">RoomTypeTable</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">);</span>
</pre></div>


<p>The datasource.name given here is injected to the Siddhi engine by the CEP/DAS server. To configure data sources in the CEP/DAS, see WSO2 Administration Guide - Configuring an RDBMS Datasource.
+ Creating an event table backed by a MySQL table
The following query creates an event table named RoomTypeTable with the attributes roomNo (an INT attribute) and type (a STRING attribute), backed by a MySQL table named <code>RoomTable</code> from the <code>cepdb</code> database located at <code>localhost:3306</code> with <code>root</code> as both the username and the password.</p>
<h5 id="caching-events">Caching Events<a class="headerlink" href="#caching-events" title="Permanent link">&para;</a></h5>
<p><br>Several caches can be used with RDBMS backed event tables in order to reduce I/O operations and improve their performance. Currently all cache implementations provide size-based algorithms.</br></p>
<p>The following elements are added with the Fromannotation to add caches.</p>
<ul>
<li>
<p><code>cache</code>: This specifies the cache implementation to be added. The supported cache implementations are as follows.</p>
<ul>
<li>
<p><code>Basic</code>: Events are cached in a First-In-First-Out manner where the oldest event is dropped when the cache is full.</p>
</li>
<li>
<p><code>LRU</code> (Least Recently Used): The least recently used event is dropped when the cache is full.</p>
</li>
<li>
<p><code>LFU</code> (Least Frequently Used): The least frequently used event is dropped when the cache is full.</p>
</li>
</ul>
<p>If the <code>cache</code> element is not specified, the basic cache is added by default.</p>
</li>
<li>
<p><code>cache.size</code>: This defines the size of the cache. If this element is not added, the default cache size of 4096 is added by default.</p>
</li>
</ul>
<p><strong>Example</strong></p>
<p>The following query creates an event table named <code>RoomTypeTable</code> with the attributes <code>roomNo</code> (an <code>INT</code> attribute) and <code>type</code> (a <code>STRING</code> attribute), backed by an RDBMS table using the LRU algorithm for caching 3000 events.</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="k">From</span><span class="p">(</span><span class="n">eventtable</span><span class="o">=</span><span class="s1">&#39;rdbms&#39;</span><span class="p">,</span> <span class="n">datasource</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;AnalyticsDataSource&#39;</span><span class="p">,</span> <span class="k">table</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;RoomTable&#39;</span><span class="p">,</span> <span class="k">cache</span><span class="o">=</span><span class="s1">&#39;LRU&#39;</span><span class="p">,</span> <span class="k">cache</span><span class="p">.</span><span class="k">size</span><span class="o">=</span><span class="s1">&#39;3000&#39;</span><span class="p">)</span><span class="n">define</span> <span class="k">table</span> <span class="n">RoomTypeTable</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">);</span>
</pre></div>


<h5 id="using-bloom-filters">Using Bloom filters<a class="headerlink" href="#using-bloom-filters" title="Permanent link">&para;</a></h5>
<p>A Bloom Filter is an algorithm or an approach that can be used to perform quick searches. If you apply a Bloom Filter to a data set and carry out an <code>isAvailablecheck</code> on that specific Bloom Filter instance, an accurate answer is returned if the search item is not available. This allows the quick improvement of updates, joins and <code>isAvailable</code> checks.</p>
<p><strong>Example</strong></p>
<p>The following example shows how to include Bloom filters in an event table update query.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">StockStream</span> <span class="p">(</span><span class="n">symbol</span> <span class="n">string</span><span class="p">,</span> <span class="n">price</span> <span class="nb">float</span><span class="p">,</span> <span class="n">volume</span> <span class="n">long</span><span class="p">);</span><span class="n">define</span> <span class="n">stream</span> <span class="n">CheckStockStream</span> <span class="p">(</span><span class="n">symbol</span> <span class="n">string</span><span class="p">,</span> <span class="n">volume</span> <span class="n">long</span><span class="p">);</span>
<span class="o">@</span><span class="k">from</span><span class="p">(</span><span class="n">eventtable</span> <span class="o">=</span> <span class="s1">&#39;rdbms&#39;</span> <span class="p">,</span><span class="n">datasource</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;cepDB&#39;</span> <span class="p">,</span> <span class="k">table</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;stockInfo&#39;</span> <span class="p">,</span> <span class="n">bloom</span><span class="p">.</span><span class="n">filters</span> <span class="o">=</span> <span class="s1">&#39;enable&#39;</span><span class="p">)</span>
<span class="n">define</span> <span class="k">table</span> <span class="n">StockTable</span> <span class="p">(</span><span class="n">symbol</span> <span class="n">string</span><span class="p">,</span> <span class="n">price</span> <span class="nb">float</span><span class="p">,</span> <span class="n">volume</span> <span class="n">long</span><span class="p">);</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;query1&#39;</span><span class="p">)</span>
<span class="k">from</span> <span class="n">StockStream</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">StockTable</span> <span class="p">;</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;query2&#39;</span><span class="p">)</span>
<span class="k">from</span> <span class="n">CheckStockStream</span><span class="p">[(</span><span class="n">StockTable</span><span class="p">.</span><span class="n">symbol</span><span class="o">==</span><span class="n">symbol</span><span class="p">)</span> <span class="k">in</span> <span class="n">StockTable</span><span class="p">]</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">OutStream</span><span class="p">;</span>
</pre></div>


<h3 id="supported-event-table-operators">Supported Event Table Operators<a class="headerlink" href="#supported-event-table-operators" title="Permanent link">&para;</a></h3>
<p>The following event table operators are supported for Siddhi.</p>
<h4 id="insert-into">Insert into<a class="headerlink" href="#insert-into" title="Permanent link">&para;</a></h4>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">table</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>


<p>To insert only the specified output event category, use the <code>current events</code>, <code>expired events</code> or the <code>all events</code> keyword between <code>insert</code> and <code>into</code> keywords. For more information, see Output Event Categories.</p>
<p><strong>Purpose</strong></p>
<p>To store filtered events in a specific event table.</p>
<p><strong>Parameters</strong></p>
<ul>
<li>
<p><code>input stream name</code>: The input stream from which the events are taken to be stored in the event table.</p>
</li>
<li>
<p><code>attribute name</code>: Attributes of the chosen events that are selected to be saved in the event table.</p>
</li>
<li>
<p><code>table name</code>: The name of the event table in which the events should be saved.</p>
</li>
</ul>
<p><strong>Example</strong></p>
<p>The following query inserts all the temperature events from the <code>TempStream</code> event stream to the <code>TempTable</code> event table.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">TempTable</span><span class="p">;</span>
</pre></div>


<h4 id="delete">Delete<a class="headerlink" href="#delete" title="Permanent link">&para;</a></h4>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">delete</span> <span class="o">&lt;</span><span class="k">table</span> <span class="n">name</span><span class="o">&gt;</span>
    <span class="k">on</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
</pre></div>


<p>The <code>condition</code> element specifies the basis on which events are selected to be deleted. When specifying this condition, the attribute names should be referred to with the table name.
To delete only the specified output category, use the <code>current events</code>, <code>expired events</code> or the <code>all events</code> keyword. For more information, see Output Event Categories.</p>
<p><strong>Purpose</strong></p>
<p>To delete selected events that are stored in a specific event table.</p>
<p><strong>Parameters</strong></p>
<ul>
<li>
<p><code>input stream name</code>: The input stream that is the source of the events stored in the event table.</p>
</li>
<li>
<p><code>attribute name</code>: Attributes to which the given condition is applied in order to filter the events to be deleted.</p>
</li>
<li>
<p><code>table name</code>: The name of the event table from which the filtered events are deleted.</p>
</li>
<li>
<p><code>condition</code>: The condition based on which the events to be deleted are selected.</p>
</li>
</ul>
<p><strong>Example</strong></p>
<p>The following query deletes all the entries in the <code>RoomTypeTable</code> event table that have a room number that matches the room number in any event in the <code>DeleteStream</code> event stream.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">table</span> <span class="n">RoomTypeTable</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">DeleteStream</span> <span class="p">(</span><span class="n">roomNumber</span> <span class="nb">int</span><span class="p">);</span>

<span class="k">from</span> <span class="n">DeleteStream</span>
<span class="k">delete</span> <span class="n">RoomTypeTable</span>
    <span class="k">on</span> <span class="n">RoomTypeTable</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">roomNumber</span><span class="p">;</span>
</pre></div>


<h4 id="update">Update<a class="headerlink" href="#update" title="Permanent link">&para;</a></h4>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="k">as</span> <span class="o">&lt;</span><span class="k">table</span> <span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="k">as</span> <span class="o">&lt;</span><span class="k">table</span> <span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">update</span> <span class="o">&lt;</span><span class="k">table</span> <span class="n">name</span><span class="o">&gt;</span>
    <span class="k">on</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
</pre></div>


<p>The <code>condition</code> element specifies the basis on which events are selected to be updated. When specifying this condition, the attribute names should be referred to with the table name.
To update only the specified output category, use the <code>current events</code>, <code>expired events</code> or the <code>all events</code> keyword. For more information, see Output Event Categories.</p>
<p><strong>Purpose</strong></p>
<p>To update selected events in an event table.</p>
<p><strong>Parameters</strong></p>
<ul>
<li>
<p><code>input stream name</code>: The input stream that is the source of the events stored in the event table.</p>
</li>
<li>
<p><code>attribute name</code>: Attributes to which the given <code>condition</code> is applied in order to filter the events to be updated.</p>
</li>
<li>
<p><code>table name</code>: The name of the event table in which the filtered events should be updated.</p>
</li>
<li>
<p><code>condition</code>: The condition based on which the events to be updated are selected.</p>
</li>
</ul>
<p><strong>Example</strong></p>
<p>The following query updates room type of all the events in the <code>RoomTypeTable</code> event table that have a room number that matches the room number in any event in the <code>UpdateStream</code> event stream.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">table</span> <span class="n">RoomTypeTable</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">UpdateStream</span> <span class="p">(</span><span class="n">roomNumber</span> <span class="nb">int</span><span class="p">,</span> <span class="n">roomType</span> <span class="n">string</span><span class="p">);</span>

<span class="k">from</span> <span class="n">UpdateStream</span>
<span class="k">select</span> <span class="n">roomType</span> <span class="k">as</span> <span class="k">type</span>
<span class="k">update</span> <span class="n">RoomTypeTable</span>
    <span class="k">on</span> <span class="n">RoomTypeTable</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">roomNumber</span><span class="p">;</span>
</pre></div>


<h4 id="insert-overwrite">Insert Overwrite<a class="headerlink" href="#insert-overwrite" title="Permanent link">&para;</a></h4>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="k">as</span> <span class="o">&lt;</span><span class="k">table</span> <span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="k">as</span> <span class="o">&lt;</span><span class="k">table</span> <span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="n">overwrite</span> <span class="o">&lt;</span><span class="k">table</span> <span class="n">name</span><span class="o">&gt;</span>
    <span class="k">on</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
</pre></div>


<p>The <code>condition</code> element specifies the basis on which events are selected to be inserted or overwritten. When specifying this condition, the attribute names should be referred to with the table name.
When specifying the <code>table attribute</code> name, the attributes should be specified with the same name specified in the event table, allowing Siddhi to identify the attributes that need to be updated/inserted in the event table.</p>
<p><strong>Purpose</strong></p>
<p><strong>Parameters</strong></p>
<ul>
<li>
<p><code>input stream name</code>: The input stream that is the source of the events stored in the event table.</p>
</li>
<li>
<p><code>attribute name</code>: Attributes to which the given <code>condition</code> is applied in order to filter the events to be inserted or over-written.</p>
</li>
<li>
<p><code>table name</code>: The name of the event table in which the filtered events should be inserted or over-written.</p>
</li>
<li>
<p><code>condition</code> : The condition based on which the events to be inserted or over-written are selected.</p>
</li>
</ul>
<p><em>Example</em>
The following query searches for events in the <code>UpdateTable</code> event table that have room numbers that match the same in the <code>UpdateStream</code> stream. When such events are founding the event table, they are updated. When a room number available in the stream is not found in the event table, it is inserted from the stream.
 ```sql
 define table RoomTypeTable (roomNo int, type string);
 define stream UpdateStream (roomNumber int, roomType string);</p>
<p>from UpdateStream
 select roomNumber as roomNo, roomType as type
 insert overwrite RoomTypeTable
     on RoomTypeTable.roomNo == roomNo;
 ```</p>
<h4 id="in">In<a class="headerlink" href="#in" title="Permanent link">&para;</a></h4>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span> <span class="k">in</span> <span class="o">&lt;</span><span class="k">table</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>


<p>The <code>condition</code> element specifies the basis on which events are selected to be inserted or overwritten. When specifying this condition, the attribute names should be referred to with the table name.</p>
<p><strong>Purpose</strong></p>
<p><strong>Parameters</strong></p>
<p><strong>Example</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">table</span> <span class="n">ServerRoomTable</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span> <span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="n">TempStream</span><span class="p">[</span><span class="n">ServerRoomTable</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">roomNo</span> <span class="k">in</span> <span class="n">ServerRoomTable</span><span class="p">]</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">ServerTempStream</span><span class="p">;</span>
</pre></div>


<h4 id="join">Join<a class="headerlink" href="#join" title="Permanent link">&para;</a></h4>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;#</span><span class="n">window</span><span class="p">.</span><span class="k">length</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">join</span> <span class="o">&lt;</span><span class="k">table_name</span><span class="o">&gt;</span>
    <span class="k">on</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="k">table_name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="k">table</span> <span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">table_name</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="k">table</span> <span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>


<p>At the time of joining, the event table should not be associated with window operations because an event table is not an active construct. Two event tables cannot be joined with each other due to the same reason.</p>
<p><strong>Purpose</strong>
To allow a stream to retrieve information from an event table.</p>
<p><strong>Parameters</strong></p>
<p><strong>Example</strong></p>
<p>The following query performs a join to update the room number of the events in the <code>TempStream</code> stream with that of the corresponding events in the <code>RoomTypeTable</code> event table, and then inserts the updated events into the <code>EnhancedTempStream</code> stream.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">table</span> <span class="n">RoomTypeTable</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span> <span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="n">TempStream</span> <span class="k">join</span> <span class="n">RoomTypeTable</span>
    <span class="k">on</span> <span class="n">RoomTypeTable</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">TempStream</span><span class="p">.</span><span class="n">roomNo</span>
<span class="k">select</span> <span class="n">deviceID</span><span class="p">,</span> <span class="n">RoomTypeTable</span><span class="p">.</span><span class="n">roomNo</span> <span class="k">as</span> <span class="n">roomNo</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">temp</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">EnhancedTempStream</span><span class="p">;</span>
</pre></div>


<h2 id="event-window">Event Window<a class="headerlink" href="#event-window" title="Permanent link">&para;</a></h2>
<p>An event window is a window that can be shared across multiple queries. Events are inserted from one or more streams. The event window publishes current and/or expired events as the output. The time at which these events are published depends on the window type.</p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax for an event window.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">window</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">window</span> <span class="n">name</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">)</span> <span class="o">&lt;</span><span class="n">window</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="err"></span><span class="p">)</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">event</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>


<p><strong>Examples</strong></p>
<ul>
<li>Returning all output categories</li>
</ul>
<p>In the following query, the window type is not specified in the window definition. Therefore, it emits both current and expired events as the output.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">window</span> <span class="n">SensorWindow</span> <span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">,</span> <span class="n">value</span> <span class="nb">float</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">deviceID</span> <span class="n">string</span><span class="p">)</span> <span class="n">timeBatch</span><span class="p">(</span><span class="mi">1</span> <span class="k">second</span><span class="p">);</span>
</pre></div>


<ul>
<li>Returning a specified output category</li>
</ul>
<p>In the following query, the window type is <code>output all events</code>. Therefore, it emits both current and expired events as the output.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">window</span> <span class="n">SensorWindow</span> <span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">,</span> <span class="n">value</span> <span class="nb">float</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">deviceID</span> <span class="n">string</span><span class="p">)</span> <span class="n">timeBatch</span><span class="p">(</span><span class="mi">1</span> <span class="k">second</span><span class="p">)</span> <span class="k">output</span> <span class="k">all</span> <span class="n">events</span><span class="p">;</span>
</pre></div>


<h3 id="supported-event-window-operators">Supported Event Window Operators<a class="headerlink" href="#supported-event-window-operators" title="Permanent link">&para;</a></h3>
<p>The following operators are supported for event windows.</p>
<h4 id="insert-into_1">Insert Into<a class="headerlink" href="#insert-into_1" title="Permanent link">&para;</a></h4>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="n">window</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>


<p>To insert only the specified output event category, use the <code>current events</code>, <code>expired events</code> or the <code>all events</code> keyword between <code>insert</code> and <code>into</code> keywords. For more information, see Output Event Categories.</p>
<p><strong>Purpose</strong></p>
<p>To insert events from an event stream to a window.</p>
<p><strong>Parameters</strong></p>
<ul>
<li>
<p><code>input stream name</code>:  The event stream from which events are inserted into the event window.</p>
</li>
<li>
<p><code>attribute name</code>: The name of the attributes with which the events are inserted from the event stream to the event window. Multiple attributes can be specified as a comma separated list.</p>
</li>
<li>
<p><code>window name</code>: The event window to which events are inserted from the event stream.</p>
</li>
</ul>
<p><strong>Example</strong></p>
<p>The following query inserts both current and expired events from an event stream named <code>sensorStream</code> to an event window named <code>sensorWindow</code>.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">SensorStream</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">SensorWindow</span><span class="p">;</span>
</pre></div>


<h4 id="output">Output<a class="headerlink" href="#output" title="Permanent link">&para;</a></h4>
<p>An event window can be used as a stream in any query. However, an ordinary window cannot be applied to the output of an event window.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="n">window</span> <span class="n">name</span><span class="o">&gt;</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>


<p><strong>Purpose</strong></p>
<p>To inject the output of an event window into an event stream.</p>
<p><strong>Parameters</strong></p>
<ul>
<li>
<p><code>window name</code>: The event window of which the output is injected into the specified stream.</p>
</li>
<li>
<p><code>attribute name</code>: The name of the attributes with which the events are inserted from the event stream to the event window. Multiple attributes can be specified as a comma separated list.</p>
</li>
<li>
<p><code>event stream name</code>: The event stream to which the output of the specified event window is injected.</p>
</li>
</ul>
<p><strong>Example</strong>
The following query selects the name and the maximum values for the <code>value</code> and <code>roomNo</code> attributes from an event window named <code>SensorWindow</code>, and inserts them into an event stream named <code>MaxSensorReadingStream</code>.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">SensorWindow</span>
<span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">as</span> <span class="k">maxValue</span><span class="p">,</span> <span class="n">roomNo</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">MaxSensorReadingStream</span><span class="p">;</span>
</pre></div>


<h4 id="join_1">Join<a class="headerlink" href="#join_1" title="Permanent link">&para;</a></h4>
<p><strong>Example</strong></p>
<div class="codehilite"><pre><span></span> <span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>
 <span class="n">define</span> <span class="n">stream</span> <span class="n">RegulatorStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">isOn</span> <span class="n">bool</span><span class="p">);</span>
 <span class="n">define</span> <span class="n">window</span> <span class="n">TempWindow</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">)</span> <span class="n">time</span><span class="p">(</span><span class="mi">1</span> <span class="k">min</span><span class="p">);</span>

 <span class="k">from</span> <span class="n">TempStream</span><span class="p">[</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">.</span><span class="mi">0</span><span class="p">]</span>
 <span class="k">insert</span> <span class="k">into</span> <span class="n">TempWindow</span><span class="p">;</span>

 <span class="k">from</span> <span class="n">TempWindow</span>
 <span class="k">join</span> <span class="n">RegulatorStream</span><span class="p">[</span><span class="n">isOn</span> <span class="o">==</span> <span class="k">false</span><span class="p">]</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="k">length</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">R</span>
 <span class="k">on</span> <span class="n">TempWindow</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">R</span><span class="p">.</span><span class="n">roomNo</span>
 <span class="k">select</span> <span class="n">TempWindow</span><span class="p">.</span><span class="n">roomNo</span><span class="p">,</span> <span class="n">R</span><span class="p">.</span><span class="n">deviceID</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span> <span class="k">as</span> <span class="n">action</span>
 <span class="k">insert</span> <span class="k">into</span> <span class="n">RegulatorActionStream</span><span class="p">;</span>
</pre></div>


<h2 id="event-trigger">Event Trigger<a class="headerlink" href="#event-trigger" title="Permanent link">&para;</a></h2>
<p>Event triggers allow events to be created periodically based on a specified time interval.</p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax for an event trigger definition.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">trigger</span> <span class="o">&lt;</span><span class="k">trigger</span> <span class="n">name</span><span class="o">&gt;</span> <span class="k">at</span> <span class="err">{</span><span class="s1">&#39;start&#39;</span><span class="o">|</span> <span class="k">every</span> <span class="o">&lt;</span><span class="n">time</span> <span class="nb">interval</span><span class="o">&gt;|</span> <span class="s1">&#39;&lt;cron expression&gt;&#39;</span><span class="err">}</span><span class="p">;</span>
</pre></div>


<p><strong>Examples</strong></p>
<ul>
<li>Triggering events regularly at specific time intervals</li>
</ul>
<p>The following query triggers events every 5 minutes.</p>
<div class="codehilite"><pre><span></span> <span class="n">define</span> <span class="k">trigger</span> <span class="n">FiveMinTriggerStream</span> <span class="k">at</span> <span class="k">every</span> <span class="mi">5</span> <span class="k">min</span><span class="p">;</span>
</pre></div>


<ul>
<li>Triggering events at a specific time on specified days
The following query triggers an event at 10.15 AM every Monday, Tuesday, Wednesday, Thursday and Friday.</li>
</ul>
<div class="codehilite"><pre><span></span> <span class="n">define</span> <span class="k">trigger</span> <span class="n">FiveMinTriggerStream</span> <span class="k">at</span> <span class="s1">&#39;0 15 10 ? * MON-FRI&#39;</span><span class="p">;</span>
</pre></div>


<h2 id="siddhi-logger">Siddhi Logger<a class="headerlink" href="#siddhi-logger" title="Permanent link">&para;</a></h2>
<p>The Siddhi Logger logs events that arrive in different logger priorities such as <code>INFO</code>, <code>DEBUG</code>, <code>WARN</code>, <code>FATAL</code>, <code>ERROR</code>, <code>OFF</code>, and <code>TRACE</code>.</p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax for a query with a Siddhi logger.</p>
<div class="codehilite"><pre><span></span><span class="o">&lt;</span><span class="n">void</span><span class="o">&gt;</span> <span class="n">log</span><span class="p">(</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">priority</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">logMessage</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">bool</span><span class="o">&gt;</span> <span class="n">isEventLogged</span><span class="p">)</span>
</pre></div>


<p>The parameters configured are as follows.</p>
<ul>
<li>
<p><code>prioroty</code>: The logging priority. Possible values are <code>INFO</code>, <code>DEBUG</code>, <code>WARN</code>, <code>FATAL</code>, <code>ERROR</code>, <code>OFF</code>, and <code>TRACE</code>. If no value is specified for this parameter, <code>INFO</code> is printed as the priority by default.</p>
</li>
<li>
<p><code>logMessage</code>: This parameter allows you to specify a message to be printed in the log.</p>
</li>
<li>
<p><code>isEventLogged</code>: This parameter specifies whether the event body should be included in the log. Possible values are <code>true</code> and <code>false</code>. If no value is specified, the event body is not printed in the log by default.</p>
</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>The following query logs the event with the <code>INFO</code> logging priority. This is because the priority is not specified.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">StockStream</span><span class="o">#</span><span class="n">log</span><span class="p">()</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">OutStream</span><span class="p">;</span>
</pre></div>


<ul>
<li>The following query logs the event with the <code>INFO</code> logging priority (because the priority is not specified) and the <code>test message</code> text.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">StockStream</span><span class="o">#</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;test message&#39;</span><span class="p">)</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">OutStream</span><span class="p">;</span>
</pre></div>


<ul>
<li>The following query logs the event with the <code>INFO</code> logging priority because a priority is not specified. The event itself is printed in the log.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">StockStream</span><span class="o">#</span><span class="n">log</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">OutStream</span><span class="p">;</span>
</pre></div>


<ul>
<li>The following query logs the event with the <code>INFO</code> logging priority (because the priority is not specified) and the <code>test message</code> text. The event itself is printed in the log.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">StockStream</span><span class="o">#</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;test message&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">OutStream</span><span class="p">;</span>
</pre></div>


<ul>
<li>The following query logs the event with the <code>WARN</code> logging priority and the <code>test message</code> text.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">StockStream</span><span class="o">#</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;warn&#39;</span><span class="p">,</span><span class="s1">&#39;test message&#39;</span><span class="p">)</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">OutStream</span><span class="p">;</span>
</pre></div>


<ul>
<li>The following query logs the event with the <code>WARN</code> logging priority and the <code>test message</code> text.  The event itself is printed in the log.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">StockStream</span><span class="o">#</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;warn&#39;</span><span class="p">,</span><span class="s1">&#39;test message&#39;</span><span class="p">,</span><span class="k">true</span><span class="p">)</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">OutStream</span><span class="p">;</span>
</pre></div>


<h2 id="eval-script">Eval Script<a class="headerlink" href="#eval-script" title="Permanent link">&para;</a></h2>
<p>Eval script allows Siddhi to process events using other programming languages by including their functions in the Siddhi queries. Eval script functions can be defined like event tables or streams and referred in the queries as Inbuilt Functions of Siddhi.</p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax for a Siddhi query with an Eval Script definition.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">function</span> <span class="o">&lt;</span><span class="k">function</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="k">language</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">]</span> <span class="k">return</span> <span class="o">&lt;</span><span class="k">return</span> <span class="k">type</span><span class="o">&gt;</span> <span class="err">{</span>
    <span class="o">&lt;</span><span class="k">operation</span> <span class="k">of</span> <span class="n">the</span> <span class="k">function</span><span class="o">&gt;</span>
<span class="err">}</span><span class="p">;</span>
</pre></div>


<p>The following parameters are configured when defining an eval script.</p>
<ul>
<li>
<p><code>function name</code>:  The name of the function from another programming language that should be included in the Siddhi query.</p>
</li>
<li>
<p><code>language name</code>: The name of the other programming language from which the function included in the Siddhi query is taken. The languages supported are JavaScript, R and Scala.</p>
</li>
<li>
<p><code>return type</code>: The return type of the function defined. The return type can be <code>int</code>, <code>long</code>, <code>float</code>, <code>double</code>, <code>string</code>, <code>bool</code> or <code>object</code>. Here the function implementer should be responsible for returning the output on the defined return type for proper functionality. </p>
</li>
<li>
<p><code>operation of the function</code>: Here, the execution logic of the defined logos should be added. This logic should be written in the language specified in the <code>language name</code> parameter, and the return should be of the type specified in the <code>return type</code> parameter.</p>
</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>Concatenating a JavaScript function</li>
</ul>
<p>The following query performs the concatenating function of the JavaScript language and returns the output as a string.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">function</span> <span class="n">concatFn</span><span class="p">[</span><span class="n">JavaScript</span><span class="p">]</span> <span class="k">return</span> <span class="n">string</span> <span class="err">{</span>
    <span class="n">var</span> <span class="n">str1</span> <span class="o">=</span> <span class="k">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">var</span> <span class="n">str2</span> <span class="o">=</span> <span class="k">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">var</span> <span class="n">str3</span> <span class="o">=</span> <span class="k">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="n">var</span> <span class="n">responce</span> <span class="o">=</span> <span class="n">str1</span> <span class="o">+</span> <span class="n">str2</span> <span class="o">+</span> <span class="n">str3</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">responce</span><span class="p">;</span>
<span class="err">}</span><span class="p">;</span>

<span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="n">TempStream</span>
<span class="k">select</span> <span class="n">concatFn</span><span class="p">(</span><span class="n">roomNo</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">deviceID</span><span class="p">)</span> <span class="k">as</span> <span class="n">id</span><span class="p">,</span> <span class="n">temp</span> 
<span class="k">insert</span> <span class="k">into</span> <span class="n">DeviceTempStream</span><span class="p">;</span>
</pre></div>


<ul>
<li>Concatenating an R function</li>
</ul>
<p>The following query performs the concatenating function of the R language and returns the output as a string.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">function</span> <span class="n">concatFn</span><span class="p">[</span><span class="n">R</span><span class="p">]</span> <span class="k">return</span> <span class="n">string</span> <span class="err">{</span>
    <span class="k">return</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="k">data</span><span class="p">,</span> <span class="n">collapse</span><span class="o">=</span><span class="ss">&quot;&quot;</span><span class="p">));</span>
<span class="err">}</span><span class="p">;</span>

<span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="n">TempStream</span>
<span class="k">select</span> <span class="n">concatFn</span><span class="p">(</span><span class="n">roomNo</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">deviceID</span><span class="p">)</span> <span class="k">as</span> <span class="n">id</span><span class="p">,</span> <span class="n">temp</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">DeviceTempStream</span><span class="p">;</span>
</pre></div>


<ul>
<li>Concatenating a Scala function</li>
</ul>
<p>The following query performs the concatenating function of the Scala language and returns the output as a string.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">function</span> <span class="n">concatFn</span><span class="p">[</span><span class="n">Scala</span><span class="p">]</span> <span class="k">return</span> <span class="n">string</span> <span class="err">{</span>
    <span class="n">var</span> <span class="n">concatenatedString</span> <span class="o">=</span>
     <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;-</span> <span class="mi">0</span> <span class="k">until</span> <span class="k">data</span><span class="p">.</span><span class="k">length</span><span class="p">)</span><span class="err">{</span>
         <span class="n">concatenatedString</span> <span class="o">+=</span> <span class="k">data</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">toString</span>
     <span class="err">}</span>
     <span class="n">concatenatedString</span>
<span class="err">}</span><span class="p">;</span>

<span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="n">TempStream</span>
<span class="k">select</span> <span class="n">concatFn</span><span class="p">(</span><span class="n">roomNo</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">deviceID</span><span class="p">)</span> <span class="k">as</span> <span class="n">id</span><span class="p">,</span> <span class="n">temp</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">DeviceTempStream</span><span class="p">;</span>
</pre></div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../user-guide/" title="User Guide" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                User Guide
              </span>
            </div>
          </a>
        
        
          <a href="../../extensions/" title="Extensions" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Extensions
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2011 - 2017 WSO2
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/wso2/siddhi" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://www.linkedin.com/groups/13553064" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-6b599127bc.js"></script>
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-103065-28","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>